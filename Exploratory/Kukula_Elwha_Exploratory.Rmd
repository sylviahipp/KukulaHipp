---
title: "Kukula_Elwha_Exploratory"
author: "Kaitlyn Kukula"
date: "`r Sys.Date()`"
output: pdf_document
editor_options: 
  chunk_output_type: console
---

## NOTES

The goal of this study is to perform a general review of coastal organisms following the removal of two dams from the Elwha River in Washington. Some interesting questions to consider could be the use of eDNA for tracking fish movements or determining food chain transformations. 

USGS Report (PDF in folder): chrome-extension://efaidnbmnnnibpcajpcglclefindmkaj/https://pubs.usgs.gov/sir/2011/5120/pdf/sir20115120.pdf

A general structure of the study could include:
1. System analysis: streamflow at available USGS gage site, estuary sediment transport
2. Comparing water quality metrics before and after dam removal
   Literature review may be required to put these values in context
3. Mapping and comparing species distribution/abundance before and after dam removal
4. Mapping and comparing eDNA and species distribution/abundance

Available data:
- eDNA shedding from live and dead fish
- Estuarian fish
- Estuarian riparian veg abundance
- Estuarian riparian veg richness
- Estuarian sediment
- Estuarian WQ
- eDNA post-removal

Data we need to gather or find:
- USGS Gage Station #12045500
- USGS Gage Station #12044900
- Watershed spatial data

Some maps I think would be useful:
Map 1. Elwha River watershed including major tributaries, dams, USGS monitoring stations, and an inset map showing the general location in Washington
Map 2-n. Sample collection sites for organism studies. This could be an interactive map.
Map n+1: Might be interested in showing the spatial species distributions if we find anything of note? This could be an interactive map. 

Some figures I think would be useful:
- Streamflow at both sites as a function of time
- Species comparisons before and after dam removal

```{r}
library(ggplot2)
library(tidyverse)
library(here)
library(lubridate)

here()

kak_theme <- theme_classic() +
  theme(plot.title = element_text(size = 11, hjust = 0.5, face = "bold"), #Adjust title
        axis.text.x = element_text(size = 9), # Adjust x-axis values
        axis.text.y = element_text(size = 9), # Adjust y-axis values
        axis.title.x = element_text(size = 10.5, face = "bold"), # Adjust x-axis title
        axis.title.y = element_text(size = 10.5, face = "bold"), # Adjust y-axis title
        legend.position = "bottom", # Define legend position
        legend.text = element_text(size = 9), # Define legend entry sizes
        legend.title = element_text(size = 9)) # Define legend name sizes
set_theme(kak_theme)
```

## Daily discharge data 1998 - 2025

```{r fig.cap = "Mean Monthly Discharge of the Elwha River from 1998 - 2024 (gage station 12045500)}

discharge_12045500_raw <- read.csv(here("Data/Raw/daily_discharge_ 12045500.csv"))
discharge_12045500 <- discharge_12045500_raw %>%
  mutate(time = mdy(time),
         value = as.numeric(value),
         day = day(time), 
         month = month(time),
         year = year(time)) 

ggplot(data = discharge_12045500 %>% filter(year > 2011 & year < 2020)) +
  geom_line(aes(x = time,y = value))

# Calculating the discharge over a set of years

year_start = 1998
year_end = 2024
discharge_12045500_mean <- discharge_12045500 %>%
  group_by(month) %>%
  filter(year > year_start & year < year_end) %>%
  summarise(mean_discharge = mean(value),
            min_discharge = min(value),
            max_discharge = max(value),
            q25_discharge = quantile(value, 0.25),
            q75_discharge = quantile(value, 0.75))

# Plotting discharge

ggplot(discharge_12045500_mean) +
  geom_point(aes(x = month, y = mean_discharge)) +
  geom_line(aes(x = month, y = mean_discharge)) +
  labs(x = "Month",
       y = "Discharge [ft^3/s]") +
  scale_x_continuous(breaks = 1:12, 
                     labels = month.abb) +
  scale_y_continuous(breaks=seq(0,3000,500)) +
  geom_errorbar(aes(x = month,
                    y = mean_discharge,
                    ymin = q25_discharge,
                    ymax = q75_discharge),
                width = 0.2)
```

# Daily gage data

```{r}
gage_12045500_raw <- read.csv(here("Data/Raw/field_measurements_12045500.csv"))

```


