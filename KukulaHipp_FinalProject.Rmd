---
title: "Elwha River Dam Removal"
author: "Sylvia Hipp and Kaitlyn Kukula"
date: "Fall 2025"
output: pdf_document
editor_options:
  chunk_output_type: console
markdown: 
  wrap: none
---

\newpage
\tableofcontents 
\newpage
\listoftables 
\listoffigures 
\newpage

Sylvia: discharge, gage height, sediment, fish transport
Kaitlyn: invert abundance, fish abundance, fish diet

```{r, echo = FALSE, include = FALSE}
library(ggplot2)
library(tidyverse)
library(here)
library(lubridate)
library(cowplot)
library(janitor)
library(glue)
library(zoo)
library(tseries)
library(Kendall)
library(knitr)
library(kableExtra)

# check working directory
# here()

kukulahipp_theme <- theme_classic() +
  theme(plot.title = element_text(size = 11, hjust = 0.5, face = "bold"), #Adjust title
        plot.subtitle = element_text(size = 10, hjust = 0.5),
        axis.text.x = element_text(size = 9), # Adjust x-axis values
        axis.text.y = element_text(size = 9), # Adjust y-axis values
        axis.title.x = element_text(size = 10.5), # Adjust x-axis title
        axis.title.y = element_text(size = 10.5), # Adjust y-axis title
        legend.position = "bottom", # Define legend position
        legend.text = element_text(size = 9), # Define legend entry sizes
        legend.title = element_text(size = 9)) # Define legend name sizes

# set theme globally
theme_set(kukulahipp_theme)
```

# I. Introduction

The Elwha River in Washington was the site of one of the largest dam removal projects in United States history. Headwatered in the Olympic Mountains of Washington and flowing to the Strait of Juan de Fuca, the Elwha River originally supported all five Pacific salmon species, steelhead, and other fish populations, along with the Lower Elwha Klallam Tribe. However, the Elwha Dam and Glines Canyon Dam, located 7.9 km and 21.6 km from the river mouth, respectively, blocked fish and sediment passage for more than 100 years (**Figures 1** and **2**). 

```{r echo=FALSE, out.width="50%", fig.align="center", fig.height=3, fig.cap = "Elwha Dam approximately one month into removal (NPS 2025)"}
knitr::include_graphics("~/KukulaHipp/Images/ElwhaDamRemovalNPS.png")
```

```{r echo=FALSE, out.width="50%", fig.align="center", fig.height=3, fig.cap = "Glines Canyon Dam approximately one month into removal (NPS 2025)"}
knitr::include_graphics("~/KukulaHipp/Images/GlinesDamRemovalNPS.png")
```

Alongside the concern for fish populations and ecological balance was the concern of rising sea level and the impacts that dams have on coastal erosion and resilience. To restore the passage of fish, preserve the watershed, and protect the people, the Lower Elwha Klallam Tribe sought to remove the dams. They were instrumental in the passing of the Elwha River Ecosystem and Fisheries Restoration Act in 1992, but it took 20 years for dam removal to begin. Thus, from 2011 to 2014, the two dams were removed and impacts were tracked by a team of federal, state, tribal, academic, and community partners.

Studies were conducted before, during, and after dam removal to understand the shifts in the geomorphology, hydrology, and ecology caused by the removal. Various groups sought to characterize phenomena such as sediment and woody debris dispersion, vegetation growth, invertebrate densities, and fish migration. In this study, we sought to analyze a portion of these impacts and specifically focused on the impacts on streamflow, sediment transport, water quality, invertebrate density, fish migration, and fish diet before, during, and after the dam removal.

Specific questions studied here include:

- Question 1. How are river discharge and gage height impacted by dam removal? 
- Question 2. Is there an observable impact on sediment load and concentration following dam removal? 
- Question 3. Is water quality and nutrient availability impacted by the dam removal?
- Question 4. Is there a shift in the types of taxa consumed by Chinook and Coho salmon before and after the dam removal?

------->Sylvia you put your stuff here about the fish movement
-  5. Fish movement?
\newpage

# II. Dataset Information

We have obtained multiple datasets from the United States Geological Survey (USGS) in regards to the Elwha River dam removals. **For more information on data availability and sources, see Appendix.** These datasets include:

1. Elwha River continuous gage height and discharge levels before, during, and after removal
2. Elwha River daily sediment loads and concentrations during and after dam removal
3. Elwha River water quality at the estuary
4. Invertebrate abundance and density at multiple sites in the estuary  **REMOVE??**
5. Chinook and Coho salmon diets, sampled at estuary sites

The relative locations of the Elwha River watershed, communities, USGS monitoring sites, and Elwha and Glines Canyon Dams are depicted in **Figure 3** (map sourced from "Coastal Habitats of the Elwha River, Washington-Biological and Physical Patterns and Processes Prior to Dam Removal", published 2011 by USGS).

```{r echo=FALSE, out.width="50%", fig.align="center", fig.height=3, fig.cap = "Elwha River watershed, monitoring stations, and dam locations (USGS, 2011)"}
knitr::include_graphics("~/KukulaHipp/Images/ElwhaWatershedMap.png")
```

## II.A. Streamflow Data 

We obtained continuous gage height and discharge data along the Elwha River from USGS's Water Data for the Nation at several USGS monitoring stations along the Elwha River. Data availability for each monitoring station is discussed in-depth in **Section III.A** below. 

Through USGS Water Data for the Nation (https://waterdata.usgs.gov/), continuous data are available at 15-minute increments for a variety of metrics, including discharge, gage height, and water turbidity. A glimpse of the raw data appears in **Table 1**.  

```{r include=FALSE}
# function to read in raw data
read_usgs_data <- function(parameter, site_no, start, end){
  data_url <- glue(paste0("https://nwis.waterservices.usgs.gov/nwis/iv/?",
                          "sites={site_no}&agencyCd=USGS&",
                          "startDT={start}T00:00:00.000-08:00&",
                          "endDT={end}T23:59:59.999-08:00",
                          "&parameterCd={parameter}&format=rdb"))
  
  param_name <- case_when(parameter == "00065" ~ "gage_height_ft", 
                          parameter == "00060" ~ "discharge_cfs")
  
  df_raw <- read.table(file = data_url, 
                       skip = 26, 
                       header = TRUE, 
                       sep = "\t") %>% 
    tibble() %>% 
    select(-c(6)) %>% 
    rename(!!param_name:=5)
  
  return(df_raw[2:nrow(df_raw),]) # remove first row that doesn't contain data
}
```

```{r include=FALSE}
# Read in Raw Data
# USGS site no.
site_number_mid <- "12045500"
site_number_above <- "12044900"

# data time period
start = ymd("2008-01-01")
end = ymd("2017-12-31")

start_removal <- ymd("2011-09-15")
complete_removal <- ymd("2014-08-26")

# parameters
param_discharge <- "00060"
param_gage_height <- "00065"

# discharge raw data
discharge_mid_raw <- read_usgs_data(param_discharge, site_number_mid, start, end)

# gage height raw data
gage_height_mid_raw <- read_usgs_data(param_gage_height, site_number_mid, start, end)
gage_height_above_raw <- read_usgs_data(param_gage_height, site_number_above, start, end)

```

```{r echo=FALSE}
kable(
  head(gage_height_mid_raw, n = 5), 
  caption = "USGS Continuous Gage Height Raw Data") %>% 
  row_spec(0, bold = TRUE) %>%
  kable_classic(full_width = FALSE)
  
```

## II.B. Sediment 

Data on sediment load and suspended sediment concentration were obtained from the USGS ScienceBase repository (https://doi.org/10.5066/F7PG1QWC) published in support of the 2018 article by Ritchie, et al. titled "Morphodynamic evolution following sediment release from the world’s largest dam removal" (see **Appendix**). These data were measured and estimated at USGS gaging station #12046260, located on the Elwha River downstream from the Elwha Dam site. Daily data were reported from September 15, 2011 (the start of the Elwha Dam removal) through September 30, 2016 (2 years following the completion of the Glines Canyon Dam removal).

The raw daily sediment data contained 1843 observations and 18 variables measuring daily discharge, sediment concentration, sedimend load and bedload, and sediment discharge. **Table 2** shows a glimpse of the raw data for the daily suspended sediment concentration and load variables, which are of interest for our analysis. 

```{r echo=FALSE, message=FALSE, warning=FALSE, table.attr="style='width:40%;'"}
filepath <- list.files(here("Data/Raw/Elwha_DailySediment_2011_2016/"), 
                       pattern = "\\.csv", full.names = TRUE)

daily_sediment_raw <- read_csv(file = filepath) %>% 
  clean_names() %>% 
  select(day, contains("daily_ssc"), daily_suspended_sediment_load_tonnes)

kable(head(daily_sediment_raw, 5), 
      caption = "Daily Sediment Concentration and Load Raw Data") %>% 
  row_spec(0, bold = TRUE) %>%
  kable_classic(full_width = FALSE)
```

## II.C. Water Quality Data
## II.D. Salmon Diet Data

\newpage

# III. Exploratory Analysis 

## III.A. Streamflow

We focused on river discharge and gage height data to analyze changes to river hydrology following dam removal. **Table 2** outlines the availability of river discharge and gage height data at each USGS monitoring site along the Elwha River. 

*Add paragraph about wrangling and missing data*

```{r echo=FALSE, warning=FALSE}
usgs_availability <- tibble(
  "Site No." = c("12044900", "12045500", "12046260"), 
  "Relative Location" = c("Above Glines Canyon Dam", "Between Glines Canyon and Elwha Dams", "Below Elwha Dam"), 
  "Discharge" = c("Mar 1994–Sept 2011", "Oct 1989–Present", "Unavailable"), 
  "Gage Height" = c("Oct 2007–Nov 2015", "Oct 2007–Present", "Unavailable")
)

kable(usgs_availability, 
      caption = "Availability of USGS Streamflow Data") %>% 
  row_spec(0, align = "c", bold = TRUE) %>% 
  add_header_above(
    header = c(" " = 2, "Dates Available" = 2), align = "c", bold = TRUE) %>% 
  kable_classic()
```

Our goal is to analyze Elwha River streamflow before, during, and after the dam removal, which occurred over the period 2011–2014. Therefore, based on data availability, we downloaded discharge data from USGS site #12045500 and gage height data from USGS sites #12044900 and #12045500. We pulled continuous data over the period 2008–2017 (as available) to capture a 10-year window surrounding the dam removal. 

```{r include = FALSE}
# Data Cleaning
wrangle_usgs_data <- function(df_raw, param){
  avg_var = paste0("avg_", param)
  
  df <- df_raw %>% 
    mutate(datetime = as.POSIXct(datetime, tz = "PST"),
           date = as.Date(datetime), 
           !!param := as.numeric(!!sym(param)), 
           site_location = case_when(site_no == "12044900" ~ "above", 
                                     site_no == "12045500" ~ "mid"), 
           site_no = factor(site_no, levels = c("12045500", "12044900"))) %>% 
    group_by(date, site_no, site_location) %>% 
    summarize(!!avg_var := mean(!!sym(param), na.rm = TRUE)) %>% 
    ungroup()
  
  return(df)
}

gage_height_df <- bind_rows(
  wrangle_usgs_data(gage_height_mid_raw, "gage_height_ft"), 
  wrangle_usgs_data(gage_height_above_raw, "gage_height_ft")) 

discharge_df <- wrangle_usgs_data(discharge_mid_raw, "discharge_cfs")

```

To get a sense of how discharge and gage height trend over time, we first plotted the time series data. **Figures 4** and **5** show daily average discharge (in cubic feet per second) and gage height (in feet), respectively, measured at the USGS monitoring sites with available data. Daily averages were computed over all 15-minute increments recorded in a given day.

```{r echo=FALSE, fig.align='center', fig.height=3, fig.cap='Elwha River Average Daily Discharge at USGS Site 12045500 (2008–2017)'}

# fig.cap='Elwha River Average Daily Discharge at USGS Site #12045500 (2008–2017)'
# Figure: Discharge Data Site 12045500
discharge_explore_plot <- ggplot() + 
  geom_rect(aes(xmin = start_removal, xmax = complete_removal, 
                ymin = 0, ymax = 15000), alpha = 0.4, fill = "grey") +
  geom_line(data = discharge_df, aes(x = date, y = avg_discharge_cfs)) + 
  annotate(geom = "text", x = ymd("2013-03-01"), y = 14000, size = 2.5,
           label = "Dam Removal Period\n(Sept 2011-Aug 2014)") + 
  scale_y_continuous(labels = scales::comma) + 
  scale_x_date(expand=c(0,0)) +
  labs(x = NULL, 
       y = "Daily Average Discharge (cfs)")

discharge_explore_plot
```
\newpage

As is apparent in **Figure 5.A**, gage height at USGS Site #12044900 (located upriver from the Elwha Dam) experienced an immediate spike from 10 ft to nearly 600 ft immediately at the start of the Elwha Dam removal in September 2011. Because the cause and characterization of this spike is unknown, we chose to focus only on USGS Site #12045500 for our analysis of discharge and gage height surrounding the Elwha River dam removals. A time series analysis of the data collected at USGS Site #12045500 is outlined in **Section IV.A** below.


```{r echo=FALSE, warning=FALSE, fig.align='center', fig.height=6.5, fig.cap='Elwha River Average Daily Gage Height (2008–2017)'}
# Figure: Gage Height Data Sites 12045500 and 12044900
baseplot <- function(ymin, ymax, vjust){
  plot <- ggplot() + 
    geom_rect(aes(xmin = start_removal, xmax = complete_removal, 
                  ymin = ymin, ymax = ymax), alpha = 0.4, fill = "grey") + 
    annotate(geom = "text", x = ymd("2013-03-01"), y = ymax-vjust, size = 2.5,
             label = "Dam Removal Period\n(Sept 2011-Aug 2014)") +
    scale_x_date(expand=c(0,0)) +
    scale_y_continuous(limits = c(ymin, ymax)) +
    scale_color_manual(values = c("12045500" = "#1b9e77", "12044900" = "#d95f02"),
                       limits = c("12045500", "12044900"),
                       drop = FALSE) + 
    labs(x = NULL, 
         y = "Daily Average Gage Height (ft)", 
         color = "USGS Site No.")
 return(plot) 
}

gage_height_explore_plot <- baseplot(0, 600, 100) + 
  geom_line(data = gage_height_df, 
            aes(x = date, y = avg_gage_height_ft, color = site_no)) +
  theme(legend.position = "None")

gage_height_mid_only <- baseplot(9, 20, 1) + 
  geom_line(data = gage_height_df, #%>% filter(site_no == "12045500"), 
            aes(x = date, y = avg_gage_height_ft, color = site_no))

plot_grid(plotlist = list(gage_height_explore_plot, gage_height_mid_only), 
          labels = c("A", "B"),
          nrow = 2, rel_heights = c(0.45, 0.55))

```
\newpage

## III.B. Sediment

   

## III.C. Water quality

```{r include = FALSE, warning = FALSE}
estuary_wq_raw <- read.csv("~/KukulaHipp/Data/Raw/Elwha_Estuary_WQ/Elwha_estuary_water_quality_2006-2014.csv") %>%
  mutate(Date = mdy(Date.Collected))
colnames(estuary_wq_raw)
unique(estuary_wq_raw$Site.Name)
```

----------------> THIS PARAGRAPH HAS A FIGURE NUMBER THAT NEEDS FILLING IN!!
This dataset contains information of nitrate/nitrile, ammonium, and phosphate concentrations, salinity, temperature, turbidity, dissolved oxygen, and pH at five sites in the Elwha River Estuary. To better understand the individual trends and suitability of this data for analysis, each parameter was plotted against time (plots not shown - for final plot of parameters see Figure #).
----------------> THIS PARAGRAPH HAS A FIGURE NUMBER THAT NEEDS FILLING IN!!

``` {r include = FALSE,  warning = FALSE, fig.cap = "Measured nitrate/nitrile concentration [uM] before and after dam removal"}

estuary_wq_nitrate <- estuary_wq_raw %>%
  mutate(Nitrate = as.numeric(Nitrate...Nitrite.concentration)) %>%
  select(Site.Name:Longitude, Nitrate, Date)

# Create a before plot
nitrate_before_plot <- ggplot(estuary_wq_nitrate %>% filter(Date <= "2007-08-30")) +
  geom_point(aes(x = Date, y = Nitrate, color = Site.Name)) +
  geom_line(aes(x = Date, y = Nitrate, color = Site.Name), linewidth = 0.75) +
  scale_x_date(limits = c(as.Date("2006-06-01"), as.Date("2007-09-01")),
               breaks = "3 month", date_labels = "%b %Y") +
  ylim(c(0,20)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "none") +
  labs(x = NULL, y = expression(paste("Nitrate [", mu, "M]"))) +
  scale_color_manual(values = c("ES1" = "#1b9e77", "ES2" = "#d95f02"))

# Create an after plot
nitrate_after_plot <- ggplot(estuary_wq_nitrate %>% filter(Date > "2007-08-30")) +
  geom_point(aes(x = Date, y = Nitrate, color = Site.Name)) +
  geom_line(aes(x = Date, y = Nitrate, color = Site.Name), linewidth = 0.75) +
  scale_x_date(limits = c(as.Date("2013-06-28"), as.Date("2014-10-12")),
               breaks = "3 month", date_labels = "%b %Y") +
  ylim(c(0,20)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none") +
  labs(x = NULL, y = NULL) +
  scale_color_manual(values = c("ES1" = "#1b9e77","ES2" = "#d95f02",
                                "IEC" = "#7570b3", "WESC1" = "#e7298a",
                                "WESC2" = "#66a61e"))
# Create a legend plot
nitrate_legend <- get_legend(
  ggplot(estuary_wq_nitrate %>% filter(Date >= "2007-08-30")) +
  geom_point(aes(x = Date, y = Nitrate, color = Site.Name)) +
    scale_color_manual(values = c("ES1" = "#1b9e77","ES2" = "#d95f02",
                                "IEC" = "#7570b3", "WESC1" = "#e7298a",
                                "WESC2" = "#66a61e")) +
    labs(color = "Site"))

# Create a window for the before and after plots
nitrate_plot <- plot_grid(nitrate_before_plot, nitrate_after_plot)

# Create a window for the title
nitrate_title <- ggplot() + 
  labs(title = "Nitrate/Nitrile concentrations") +
  theme(plot.subtitle = element_text(hjust = 0.5))

# Generate the final plot with title, data, and legend
nitrate_plot_legend <- plot_grid(nitrate_title, nitrate_plot, nitrate_legend, 
                                 nrow = 3, rel_heights = c(0.1, 0.8, 0.1))
# Display plot
# nitrate_plot_legend
```

``` {r include = FALSE,  fig.cap = "Measured phosphate [uM] before and after dam removal"}

estuary_wq_phos <- estuary_wq_raw %>%
  mutate(Phosphate = as.numeric(Phosphate.concentration)) %>%
  select(Site.Name:Longitude, Phosphate, Date)

# Create a before plot
phos_before_plot <- ggplot(estuary_wq_phos %>% filter(Date <= "2007-08-30")) +
  geom_point(aes(x = Date, y = Phosphate, color = Site.Name)) +
  geom_line(aes(x = Date, y = Phosphate, color = Site.Name), linewidth = 0.75) +
  scale_x_date(limits = c(as.Date("2006-06-01"), as.Date("2007-09-01")),
               breaks = "3 month", date_labels = "%b %Y") +
  ylim(c(0,0.75)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "none") +
  labs(x = NULL, y = expression(paste("Phosphate [", mu, "M]"))) +
  scale_color_manual(values = c("ES1" = "#1b9e77", "ES2" = "#d95f02"))

# Create an after plot
phos_after_plot <- ggplot(estuary_wq_phos %>% filter(Date > "2007-08-30")) +
  geom_point(aes(x = Date, y = Phosphate, color = Site.Name)) +
  geom_line(aes(x = Date, y = Phosphate, color = Site.Name), linewidth = 0.75) +
  scale_x_date(limits = c(as.Date("2013-06-28"), as.Date("2014-10-12")),
               breaks = "3 month", date_labels = "%b %Y") +
  ylim(c(0,0.75)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none") +
  labs(x = NULL, y = NULL) +
  scale_color_manual(values = c("ES1" = "#1b9e77","ES2" = "#d95f02",
                                "IEC" = "#7570b3", "WESC1" = "#e7298a",
                                "WESC2" = "#66a61e"))
# Create a legend plot
phos_legend <- get_legend(
  ggplot(estuary_wq_phos %>% filter(Date >= "2007-08-30")) +
  geom_point(aes(x = Date, y = Phosphate, color = Site.Name)) +
    scale_color_manual(values = c("ES1" = "#1b9e77","ES2" = "#d95f02",
                                "IEC" = "#7570b3", "WESC1" = "#e7298a",
                                "WESC2" = "#66a61e")) +
    labs(color = "Site"))

# Create a window for the before and after plots
phos_plot <- plot_grid(phos_before_plot, phos_after_plot)

# Create a window for the title
phos_title <- ggplot() + 
  labs(title = "Phosphate concentrations") +
  theme(plot.subtitle = element_text(hjust = 0.5))

# Generate the final plot with title, data, and legend
phos_plot_legend <- plot_grid(phos_title, phos_plot, phos_legend, 
                                 nrow = 3, rel_heights = c(0.1, 0.8, 0.1))
# Display plot
#phos_plot_legend
```

``` {r include = FALSE, warning = FALSE, fig.cap = "Measured ammonium concentration [uM] before and after dam removal"}

estuary_wq_amm <- estuary_wq_raw %>%
  mutate(Ammonium = as.numeric(Ammonium.concentration)) %>%
  select(Site.Name:Longitude, Ammonium, Date)

# Create a before plot
amm_before_plot <- ggplot(estuary_wq_amm %>% filter(Date <= "2007-08-30")) +
  geom_point(aes(x = Date, y = Ammonium, color = Site.Name)) +
  geom_line(aes(x = Date, y = Ammonium, color = Site.Name), linewidth = 0.75) +
  scale_x_date(limits = c(as.Date("2006-06-01"), as.Date("2007-09-01")),
               breaks = "3 month", date_labels = "%b %Y") +
  ylim(c(0,20)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "none") +
  labs(x = NULL, y = expression(paste("Ammonium [", mu, "M]"))) +
  scale_color_manual(values = c("ES1" = "#1b9e77", "ES2" = "#d95f02"))

# Create an after plot
amm_after_plot <- ggplot(estuary_wq_amm %>% filter(Date > "2007-08-30")) +
  geom_point(aes(x = Date, y = Ammonium, color = Site.Name)) +
  geom_line(aes(x = Date, y = Ammonium, color = Site.Name), linewidth = 0.75) +
  scale_x_date(limits = c(as.Date("2013-06-28"), as.Date("2014-10-12")),
               breaks = "3 month", date_labels = "%b %Y") +
  ylim(c(0,20)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none") +
  labs(x = NULL, y = NULL) +
  scale_color_manual(values = c("ES1" = "#1b9e77","ES2" = "#d95f02",
                                "IEC" = "#7570b3", "WESC1" = "#e7298a",
                                "WESC2" = "#66a61e"))
# Create a legend plot
amm_legend <- get_legend(
  ggplot(estuary_wq_amm %>% filter(Date >= "2007-08-30")) +
  geom_point(aes(x = Date, y = Ammonium, color = Site.Name)) +
    scale_color_manual(values = c("ES1" = "#1b9e77","ES2" = "#d95f02",
                                "IEC" = "#7570b3", "WESC1" = "#e7298a",
                                "WESC2" = "#66a61e")) +
    labs(color = "Site"))

# Create a window for the before and after plots
amm_plot <- plot_grid(amm_before_plot, amm_after_plot)

# Create a window for the title
amm_title <- ggplot() + 
  labs(title = "Ammonium concentrations") +
  theme(plot.subtitle = element_text(hjust = 0.5))

# Generate the final plot with title, data, and legend
amm_plot_legend <- plot_grid(amm_title, amm_plot, amm_legend, 
                                 nrow = 3, rel_heights = c(0.1, 0.8, 0.1))
# Display plot
#amm_plot_legend
```

``` {r include = FALSE, fig.cap = "Measured salinity [PSU] before and after dam removal"}

estuary_wq_salinity <- estuary_wq_raw %>%
  mutate(Salinity = as.numeric(Salinity)) %>%
  select(Site.Name:Longitude, Salinity, Date)

# Create a before plot
salinity_before_plot <- ggplot(estuary_wq_salinity %>% filter(Date <= "2007-08-30")) +
  geom_point(aes(x = Date, y = Salinity, color = Site.Name)) +
  geom_line(aes(x = Date, y = Salinity, color = Site.Name), linewidth = 0.75) +
  scale_x_date(limits = c(as.Date("2006-06-01"), as.Date("2007-09-01")),
               breaks = "3 month", date_labels = "%b %Y") +
  ylim(c(0,0.75)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "none") +
  labs(x = NULL, y = expression(paste("Salinity [units]"))) +
  scale_color_manual(values = c("ES1" = "#1b9e77", "ES2" = "#d95f02"))

# Create an after plot
salinity_after_plot <- ggplot(estuary_wq_salinity %>% filter(Date > "2007-08-30")) +
  geom_point(aes(x = Date, y = Salinity, color = Site.Name)) +
  geom_line(aes(x = Date, y = Salinity, color = Site.Name), linewidth = 0.75) +
  scale_x_date(limits = c(as.Date("2013-06-28"), as.Date("2014-10-12")),
               breaks = "3 month", date_labels = "%b %Y") +
  ylim(c(0,0.75)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none") +
  labs(x = NULL, y = NULL) +
  scale_color_manual(values = c("ES1" = "#1b9e77","ES2" = "#d95f02",
                                "IEC" = "#7570b3", "WESC1" = "#e7298a",
                                "WESC2" = "#66a61e"))
# Create a legend plot
salinity_legend <- get_legend(
  ggplot(estuary_wq_salinity %>% filter(Date >= "2007-08-30")) +
  geom_point(aes(x = Date, y = Salinity, color = Site.Name)) +
    scale_color_manual(values = c("ES1" = "#1b9e77","ES2" = "#d95f02",
                                "IEC" = "#7570b3", "WESC1" = "#e7298a",
                                "WESC2" = "#66a61e")) +
    labs(color = "Site"))

# Create a window for the before and after plots
salinity_plot <- plot_grid(salinity_before_plot, salinity_after_plot)

# Create a window for the title
salinity_title <- ggplot() + 
  labs(title = "Salinity") +
  theme(plot.subtitle = element_text(hjust = 0.5))

# Generate the final plot with title, data, and legend
salinity_plot_legend <- plot_grid(salinity_title, salinity_plot, salinity_legend, 
                                 nrow = 3, rel_heights = c(0.1, 0.8, 0.1))
# Display plot
#salinity_plot_legend
```

``` {r include = FALSE, fig.cap = "Measured temperature [deg C] before and after dam removal"}

estuary_wq_temperature <- estuary_wq_raw %>%
  mutate(Temperature = as.numeric(Temperature)) %>%
  select(Site.Name:Longitude, Temperature, Date)

# Create a before plot
temp_before_plot <- ggplot(estuary_wq_temperature %>% filter(Date <= "2007-08-30")) +
  geom_point(aes(x = Date, y = Temperature, color = Site.Name)) +
  geom_line(aes(x = Date, y = Temperature, color = Site.Name), linewidth = 0.75) +
  scale_x_date(limits = c(as.Date("2006-06-01"), as.Date("2007-09-01")),
               breaks = "3 month", date_labels = "%b %Y") +
  ylim(c(0,15)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "none") +
  labs(x = NULL, y = expression(paste("Salinity [units]"))) +
  scale_color_manual(values = c("ES1" = "#1b9e77", "ES2" = "#d95f02"))

# Create an after plot
temp_after_plot <- ggplot(estuary_wq_temperature %>% filter(Date > "2007-08-30")) +
  geom_point(aes(x = Date, y = Temperature, color = Site.Name)) +
  geom_line(aes(x = Date, y = Temperature, color = Site.Name), linewidth = 0.75) +
  scale_x_date(limits = c(as.Date("2013-06-28"), as.Date("2014-10-12")),
               breaks = "3 month", date_labels = "%b %Y") +
  ylim(c(0,15)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none") +
  labs(x = NULL, y = NULL) +
  scale_color_manual(values = c("ES1" = "#1b9e77","ES2" = "#d95f02",
                                "IEC" = "#7570b3", "WESC1" = "#e7298a",
                                "WESC2" = "#66a61e"))
# Create a legend plot
temp_legend <- get_legend(
  ggplot(estuary_wq_temperature %>% filter(Date >= "2007-08-30")) +
  geom_point(aes(x = Date, y = Temperature, color = Site.Name)) +
    scale_color_manual(values = c("ES1" = "#1b9e77","ES2" = "#d95f02",
                                "IEC" = "#7570b3", "WESC1" = "#e7298a",
                                "WESC2" = "#66a61e")) +
    labs(color = "Site"))

# Create a window for the before and after plots
temp_plot <- plot_grid(temp_before_plot, temp_after_plot)

# Create a window for the title
temp_title <- ggplot() + 
  labs(title = "Temperature") +
  theme(plot.subtitle = element_text(hjust = 0.5))

# Generate the final plot with title, data, and legend
temp_plot_legend <- plot_grid(temp_title, temp_plot, temp_legend, 
                                 nrow = 3, rel_heights = c(0.1, 0.8, 0.1))
# Display plot
#temp_plot_legend
```

``` {r include = FALSE, fig.cap = "Measured dissolved oxygen [mg/L] before and after dam removal"}

estuary_wq_do <- estuary_wq_raw %>%
  mutate(Dissolved_Oxygen = as.numeric(Dissolved.oxygen)) %>%
  select(Site.Name:Longitude, Dissolved_Oxygen, Date)

# Create a before plot
do_before_plot <- ggplot(estuary_wq_do %>% filter(Date <= "2007-08-30")) +
  geom_point(aes(x = Date, y = Dissolved_Oxygen, color = Site.Name)) +
  geom_line(aes(x = Date, y = Dissolved_Oxygen, color = Site.Name), linewidth = 0.75) +
  scale_x_date(limits = c(as.Date("2006-06-01"), as.Date("2007-09-01")),
               breaks = "3 month", date_labels = "%b %Y") +
  ylim(c(0,15)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "none") +
  labs(x = NULL, y = expression(paste("Dissolved Oxygen [mg/L]"))) +
  scale_color_manual(values = c("ES1" = "#1b9e77", "ES2" = "#d95f02"))

# Create an after plot
do_after_plot <- ggplot(estuary_wq_do %>% filter(Date > "2007-08-30")) +
  geom_point(aes(x = Date, y = Dissolved_Oxygen, color = Site.Name)) +
  geom_line(aes(x = Date, y = Dissolved_Oxygen, color = Site.Name), linewidth = 0.75) +
  scale_x_date(limits = c(as.Date("2013-06-28"), as.Date("2014-10-12")),
               breaks = "3 month", date_labels = "%b %Y") +
  ylim(c(0,15)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none") +
  labs(x = NULL, y = NULL) +
  scale_color_manual(values = c("ES1" = "#1b9e77","ES2" = "#d95f02",
                                "IEC" = "#7570b3", "WESC1" = "#e7298a",
                                "WESC2" = "#66a61e"))
# Create a legend plot
do_legend <- get_legend(
  ggplot(estuary_wq_do %>% filter(Date >= "2007-08-30")) +
  geom_point(aes(x = Date, y = Dissolved_Oxygen, color = Site.Name)) +
    scale_color_manual(values = c("ES1" = "#1b9e77","ES2" = "#d95f02",
                                "IEC" = "#7570b3", "WESC1" = "#e7298a",
                                "WESC2" = "#66a61e")) +
    labs(color = "Site"))

# Create a window for the before and after plots
do_plot <- plot_grid(do_before_plot, do_after_plot)

# Create a window for the title
do_title <- ggplot() + 
  labs(title = "Dissolved Oxygen") +
  theme(plot.subtitle = element_text(hjust = 0.5))

# Generate the final plot with title, data, and legend
do_plot_legend <- plot_grid(do_title, do_plot, do_legend, 
                                 nrow = 3, rel_heights = c(0.1, 0.8, 0.1))
# Display plot
#do_plot_legend
```

``` {r include = FALSE, fig.cap = "Measured pH [units] before and after dam removal"}

estuary_wq_ph <- estuary_wq_raw %>%
  mutate(pH = as.numeric(pH)) %>%
  select(Site.Name:Longitude, pH, Date)

# Create a before plot
ph_before_plot <- ggplot(estuary_wq_ph %>% filter(Date <= "2007-08-30")) +
  geom_point(aes(x = Date, y = pH, color = Site.Name)) +
  geom_line(aes(x = Date, y = pH, color = Site.Name), linewidth = 0.75) +
  scale_x_date(limits = c(as.Date("2006-06-01"), as.Date("2007-09-01")),
               breaks = "3 month", date_labels = "%b %Y") +
  ylim(c(0,10)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "none") +
  labs(x = NULL, y = expression(paste("Dissolved Oxygen [units]"))) +
  scale_color_manual(values = c("ES1" = "#1b9e77", "ES2" = "#d95f02"))

# Create an after plot
ph_after_plot <- ggplot(estuary_wq_ph %>% filter(Date > "2007-08-30")) +
  geom_point(aes(x = Date, y = pH, color = Site.Name)) +
  geom_line(aes(x = Date, y = pH, color = Site.Name), linewidth = 0.75) +
  scale_x_date(limits = c(as.Date("2013-06-28"), as.Date("2014-10-12")),
               breaks = "3 month", date_labels = "%b %Y") +
  ylim(c(0,10)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none") +
  labs(x = NULL, y = NULL) +
  scale_color_manual(values = c("ES1" = "#1b9e77","ES2" = "#d95f02",
                                "IEC" = "#7570b3", "WESC1" = "#e7298a",
                                "WESC2" = "#66a61e"))
# Create a legend plot
ph_legend <- get_legend(
  ggplot(estuary_wq_ph %>% filter(Date >= "2007-08-30")) +
  geom_point(aes(x = Date, y = pH, color = Site.Name)) +
    scale_color_manual(values = c("ES1" = "#1b9e77","ES2" = "#d95f02",
                                "IEC" = "#7570b3", "WESC1" = "#e7298a",
                                "WESC2" = "#66a61e")) +
    labs(color = "Site"))

# Create a window for the before and after plots
ph_plot <- plot_grid(ph_before_plot, ph_after_plot)

# Create a window for the title
ph_title <- ggplot() + 
  labs(title = "pH") +
  theme(plot.subtitle = element_text(hjust = 0.5))

# Generate the final plot with title, data, and legend
ph_plot_legend <- plot_grid(ph_title, ph_plot, ph_legend, 
                                 nrow = 3, rel_heights = c(0.1, 0.8, 0.1))
# Display plot
#ph_plot_legend
```

To create the plots desired for analysis, the legend and title were assigned to unique variables.

```{r include = FALSE, }

# Dataset legend (grabbed from nitrate subset)
estuary_wq_legend <- get_legend(
  ggplot(estuary_wq_nitrate %>% filter(Date >= "2007-08-30")) +
  geom_point(aes(x = Date, y = Nitrate, color = Site.Name)) +
    scale_color_manual(values = c("ES1" = "#1b9e77","ES2" = "#d95f02",
                                "IEC" = "#7570b3", "WESC1" = "#e7298a",
                                "WESC2" = "#66a61e")) +
    labs(color = "Site"))

# Dataset title
dataset_title <- ggplot() + 
  labs(title = "Water Quality at the Elwha River Estuary Before and During Dam Removal",
       subtitle = "Dam removal: 2011 - 2014") +
  theme(plot.subtitle = element_text(hjust = 0.5))
```

Based on this data exploration, the parameters with useful data are nitrate/nitrile concentration, phosphate concentration, ammonium concentration, and dissolved oxygen. The other parameters had significant missing data or displayed no trend.

## III.D. Salmon Diet

``` {r include = FALSE, }
salmonid_diet_raw <- read.csv("~/KukulaHipp/Data/Raw/Elwha_estuary_fish_diet/Elwha_estuary_fish_diet.csv") %>%
  mutate(Date = mdy(Date),
         Year = as.numeric(Year)) %>% 
  janitor::clean_names()

# Summed all taxa consumed by salmon type in a year
salmonid_diet_processed <- salmonid_diet_raw %>%
  group_by(year, fish) %>% 
  summarise(across(c(acari_larva:trichoptera_pupa), ~sum(., na.rm = TRUE))) %>% 
  ungroup() %>% 
  pivot_longer(c(acari_larva:trichoptera_pupa)) %>%
  pivot_wider(id_cols = c("fish", "name"),
              names_from = "year",
              values_from = "value",
              names_prefix = "value_") %>% 
  mutate(taxa = str_extract(name, "^.+\\_") %>% str_remove_all("\\_")) %>% 
  group_by(fish, taxa) %>% 
  summarise(across(c(value_2006:value_2014), ~sum(., na.rm = TRUE))) %>% 
  ungroup() %>% 
  mutate(before_count = rowSums(across(value_2006:value_2007)),
         after_count = rowSums(across(value_2013:value_2014)),
         total_count = rowSums(across(before_count:after_count)))

#colnames(salmonid_diet_raw)

# What dates did they sample on
#unique(salmonid_diet_raw$date)

# Create a data frame for Chinook salmon diet
chinook_diet <- salmonid_diet_processed %>%
  filter(fish == "Chinook") %>% 
  mutate(value_2006 = as.numeric(value_2006),
         value_2007 = as.numeric(value_2007),
         value_2013 = as.numeric(value_2013),
         value_2014 = as.numeric(value_2014))

# Create a data frame for Coho salmon diet
coho_diet <- salmonid_diet_processed %>% filter(fish == "Coho") %>% 
  mutate(value_2006 = as.numeric(value_2006),
         value_2007 = as.numeric(value_2007),
         value_2013 = as.numeric(value_2013),
         value_2014 = as.numeric(value_2014))
```

In this dataset, the composition of Chinook and Coho salmon diets are made available. The authors sampled 12 times before the dam removal (across 2006 and 2007), and 23 times after the dam removal (across 2013 and 2014). 193 unique taxa were screened for. To assess the different taxa that comprised the diet, a dataset that contained the sum of each taxa count in each was created. For each year, the top 10 taxa more commonly observed taxa were plotted on a histogram (Figures # and #). A limitation of this study is that the number of fish surveyed was not used to normalize the data, so this dataset does not contain relative abundance.

\newpage

``` {r echo = FALSE, fig.cap = "Total counts of the 10 most common dietary taxa each year in Chinook salmon"}
# Chinook taxa in 2006
chinook_taxa_2006 <- chinook_diet %>% 
  select(fish:value_2006) %>% 
  arrange(desc(value_2006)) %>%
  filter(value_2006 > 0)

chinook_top_taxa_plot_2006 <- ggplot(data = chinook_taxa_2006 %>% head(10),
                                     aes(x = reorder(taxa, -value_2006), y = value_2006)) +
  geom_bar(stat = "identity", fill = "black") +
  theme(axis.text.x = element_text(angle = 25, hjust = 1)) +
  labs(x = NULL,
       y = NULL,
       title = "2006")
#chinook_top_taxa_plot_2006

# Chinook taxa in 2007
chinook_taxa_2007 <- chinook_diet %>% 
  select(fish:taxa, value_2007) %>% 
  arrange(desc(value_2007)) %>%
  filter(value_2007 > 0)

chinook_top_taxa_plot_2007 <- ggplot(data = chinook_taxa_2007 %>% head(n = 10),
                                     aes(x = reorder(taxa, -value_2007), y = value_2007)) +
  geom_bar(stat = "identity", fill = "black") +
  theme(axis.text.x = element_text(angle = 25, hjust = 1)) +
  labs(x = NULL,
       y = NULL,
       title = "2007")
#chinook_top_taxa_plot_2007

# Chinook in 2013

chinook_taxa_2013 <- chinook_diet %>%
  select(fish:taxa, value_2013) %>%
  arrange(desc(value_2013)) %>%
  filter(value_2013 > 0)

chinook_top_taxa_plot_2013 <- ggplot(data = chinook_taxa_2013 %>% head(n = 10),
                                     aes(x = reorder(taxa, -value_2013), y = value_2013)) +
  geom_bar(stat = "identity", fill = "black") +
  theme(axis.text.x = element_text(angle = 25, hjust = 1)) +
  labs(x = NULL,
       y = NULL,
       title = "2013")
#chinook_top_taxa_plot_2013

# Chinook in 2014

chinook_taxa_2014 <- chinook_diet %>%
  select(fish:taxa, value_2014) %>%
  arrange(desc(value_2014)) %>%
  head(n = 10)

chinook_top_taxa_plot_2014 <- ggplot(data = chinook_taxa_2014,
                                     aes(x = reorder(taxa, -value_2014), y = value_2014)) +
  geom_bar(stat = "identity", fill = "black") +
  theme(axis.text.x = element_text(angle = 25, hjust = 1)) +
  labs(x = NULL,
       y = NULL,
       title = "2014")
#chinook_top_taxa_plot_2014

chinook_diet_4x4 <- plot_grid(chinook_top_taxa_plot_2006,
                              chinook_top_taxa_plot_2007,
                              chinook_top_taxa_plot_2013,
                              chinook_top_taxa_plot_2014,
                              nrow = 2,
                              ncol = 2)
chinook_diet_4x4
```

Upon initial investigation, it is clear that the diet of Chinook salmon has diversified by 2014, and it is possible that the salmon are consuming more food (however, normalizing the data based on the number of fish and time points would be required to substantiate this claim).

\newpage

``` {r echo = FALSE, fig.cap = "Total counts of the 10 most common dietary taxa each year in Coho salmon"}
# coho taxa in 2006
coho_taxa_2006 <- coho_diet %>% 
  select(fish:value_2006) %>% 
  arrange(desc(value_2006)) %>%
  filter(value_2006 > 0)

coho_top_taxa_plot_2006 <- ggplot(data = coho_taxa_2006 %>% head(10),
                                     aes(x = reorder(taxa, -value_2006), y = value_2006)) +
  geom_bar(stat = "identity", fill = "black") +
  theme(axis.text.x = element_text(angle = 25, hjust = 1)) +
  labs(x = NULL,
       y = NULL,
       title = "2006")
#coho_top_taxa_plot_2006

# coho taxa in 2007
coho_taxa_2007 <- coho_diet %>% 
  select(fish:taxa, value_2007) %>% 
  arrange(desc(value_2007)) %>%
  filter(value_2007 > 0)

coho_top_taxa_plot_2007 <- ggplot(data = coho_taxa_2007 %>% head(n = 10),
                                     aes(x = reorder(taxa, -value_2007), y = value_2007)) +
  geom_bar(stat = "identity", fill = "black") +
  theme(axis.text.x = element_text(angle = 25, hjust = 1)) +
  labs(x = NULL,
       y = NULL,
       title = "2007")
#coho_top_taxa_plot_2007

# coho in 2013

coho_taxa_2013 <- coho_diet %>%
  select(fish:taxa, value_2013) %>%
  arrange(desc(value_2013)) %>%
  filter(value_2013 > 0)

coho_top_taxa_plot_2013 <- ggplot(data = coho_taxa_2013 %>% head(n = 10),
                                     aes(x = reorder(taxa, -value_2013), y = value_2013)) +
  geom_bar(stat = "identity", fill = "black") +
  theme(axis.text.x = element_text(angle = 25, hjust = 1)) +
  labs(x = NULL,
       y = NULL,
       title = "2013")
#coho_top_taxa_plot_2013

# coho in 2014

coho_taxa_2014 <- coho_diet %>%
  select(fish:taxa, value_2014) %>%
  arrange(desc(value_2014)) %>%
  head(n = 10)

coho_top_taxa_plot_2014 <- ggplot(data = coho_taxa_2014,
                                     aes(x = reorder(taxa, -value_2014), y = value_2014)) +
  geom_bar(stat = "identity", fill = "black") +
  theme(axis.text.x = element_text(angle = 25, hjust = 1)) +
  labs(x = NULL,
       y = NULL,
       title = "2014")
#coho_top_taxa_plot_2014

coho_diet_4x4 <- plot_grid(coho_top_taxa_plot_2006,
                              coho_top_taxa_plot_2007,
                              coho_top_taxa_plot_2013,
                              coho_top_taxa_plot_2014,
                              nrow = 2,
                              ncol = 2)
coho_diet_4x4
```

In Coho, similar trends in diversification are seen, however they begin earlier. Unlike Chinook, is is less clear that Coho are consuming more after the dam removal.

\newpage

# IV. Analysis

## IV.A. Question 1. How are river discharge and gage height impacted by dam removal?

As shown in **Figure 4** and **Figure 5** above, 

## IV.B. Question 2. Is there an observable impact on sediment load and concentration following dam removal?

## IV.C. Question 3. Is water quality and nutrient availability impacted by the dam removal?

Based on the exploratry analysis, only nitrate/nitrile, phosphate, ammonium, and dissoled oxygen concentrations were considered in this water quality analysis (Figure #). Because each datapoint is based on one reported measurement with no error attached, no statistical analyses were run. Thus, all analysis of this data is based on visual evaluation.

```{r echo = FALSE, fig.cap = "Water quality in the Elwha River estuary before and during dam removal", fig.height = 8}

# Final water quality plot
estuary_wq_plot <- plot_grid(dataset_title,
                             nitrate_title, nitrate_plot,
                             phos_title, phos_plot,
                             do_title, do_plot,
                             amm_title, amm_plot,
                             estuary_wq_legend,
                             nrow = 10, rel_heights = c(2,1,5,1,5,1,5,1,5,1,5,1))
estuary_wq_plot
```

\newpage

These parameters are all connected such that an increase in nitrates will cause an increase in phosphate, leading to an excess of plant growth and decomposition. As a result, dissolved oxygen will decrease and impact aquatic animals. Optimal ranges for these compounds include 0.16 - 48.38 uM for nitrate with lower being better (Lehigh University), and 0.05 - 0.53 uM (normal ~ 0.32) for phosphate (Univeristy of Wisconsin). Concentrations of all analyzed parameters do not breech unsafe thresholds, but it does appear that levels are increased following dam removal. However, lack of data at all sites before the dam removal makes it difficult to assess if these trends are due to the site specifically of the removal of the dam. It is observed that the expected relationships described above are generally represented for nitrate and phosphate, but it is not clear if there is an associated decrease in dissolved oxygen. The data on ammonium are hindered by missing datapoints in the middle of the time period, so it is also difficult to assess effects.

## IV.D. Question 4. Is there a shift in the types of taxa consumed by salmon before and after the dam removal?

The number of unique taxa consumed by each salmon species was assessed (Figure #). 

```{r echo = FALSE, fig.cap = "Number of unique taxa consumed by Chinook and Coho salmon in each year samples were collected"}
salmon_taxa_totals_plot <- ggplot(data = data.frame(
  Salmon = c(rep("Chinook", 4), rep("Coho", 4)),
  Year = c(rep(c("2006", "2007", "2013", "2014"),2)),
  Count = c(sum(chinook_diet$value_2006 > 0),
            sum(chinook_diet$value_2007 > 0),
            sum(chinook_diet$value_2013 > 0),
            sum(chinook_diet$value_2014 > 0),
            sum(coho_diet$value_2006 > 0),
            sum(coho_diet$value_2007 > 0),
            sum(coho_diet$value_2013 > 0),
            sum(coho_diet$value_2014 > 0))),
  aes(x = Year, y = Count, fill = as.factor(Salmon))) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Number of Dietary Taxa Observed in Salmon Diets",
       x = NULL,
       y = "Number of Taxa Observed in Salmon",
       fill = "Salmon Species") +
  scale_fill_manual(values = c("Chinook" = "#4d9221", "Coho" = "#91bfdb"))
salmon_taxa_totals_plot
```
\newpage
Before removal and into 2013, the number of unique taxa consumed by Chinook salmon appears largely unchanged. However, there was a large increase in 2014, going from 56 taxa to 85 taxa in 2014 and 2014, respectively. Coho salmon saw more consistency in the number of taxa consumed before and after, where levels were generally similar between the years. Between 2007 and 2013, an increase in 36 taxa was observed. These results suggest that dam removal had a positive impact on the diversity of both Chinook and Coho salmon diet.

To assess how the top taxa were impacted by dam removal, the top ten overall taxa were visualized (the top overall taxa reflect the sum of all counts across all years).

```{r echo = FALSE, fig.cap = "Top overall taxa for Chinook salmon before and after dam removal"}

# Overall
chinook_top_taxa <- salmonid_diet_processed %>%
  filter(fish == "Chinook") %>%
  arrange(desc(total_count)) %>%
  head(10) %>%
  select(fish:taxa, before_count:after_count) %>%
  pivot_longer(cols = c(before_count, after_count))

chinook_top_taxa_plot <- ggplot(chinook_top_taxa, aes(x = taxa, y = value, fill = as.factor(name))) +
  geom_bar(stat = "identity", position = "dodge") +
    theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Top Dietary Taxa Overall for Chinook Salmon",
       x = NULL,
       y = "Count",
       fill = NULL) +
  scale_fill_manual(values = c("before_count" = "#4d9221", "after_count" = "#91bfdb"),
                    labels = c("Before", "After")) + 
  theme(legend.position = "none")
# chinook_top_taxa_plot

dam_state_legend <- get_legend(ggplot(chinook_top_taxa, aes(x = taxa, y = value, fill = name)) +
  geom_bar(stat = "identity", position = "dodge") +
    labs(fill = NULL) +
    scale_fill_manual(values = c("before_count" = "#4d9221", 
                                 "after_count" = "#91bfdb"),
                      labels = c("Before", "After"))) 

chinook_top_taxa_3x3 <- plot_grid(chinook_top_taxa_plot,
                                  dam_state_legend,
                                  nrow = 2,
                                  rel_heights = c(3, 0.1))
chinook_top_taxa_3x3
```

For Chinook salmon, the taxa chironomidae (non-biting midges) are dominant before and after removal (Figure #). Other taxa, such as cladocera (water flea), chironomini (within the midge tribe), cyclopoida (order of small crustaceans), and osteichthyes (bony fishes) were present before removal, and either at low counts or not at all after. This could be due to water quality changes that these taxa cannot tolerate or do not prefer, increased choice in dietary foods such that salmon prefer to not eat these taxa, or a number of other reasons. Besides chironomidae, only amphipoda (order of malacostracan crustaceans) and Hilara (genus of dance flies) saw increased consumption after dam removal as compared to before. This could be due to the increased diversity in the diet that leads to fewer counts per taxa consumed.

```{r echo = FALSE, fig.cap = "Top overall taxa for Coho salmon before and after dam removal"}

# Overall
coho_top_taxa <- salmonid_diet_processed %>%
  filter(fish == "Coho") %>%
  arrange(desc(total_count)) %>%
  head(10) %>%
  select(fish:taxa, before_count:after_count) %>%
  pivot_longer(cols = c(before_count, after_count))

coho_top_taxa_plot <- ggplot(coho_top_taxa, aes(x = taxa, y = value, fill = as.factor(name))) +
  geom_bar(stat = "identity", position = "dodge") +
    theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Top Dietary Taxa Overall for Coho Salmon",
       x = NULL,
       y = "Count",
       fill = NULL) +
  scale_fill_manual(values = c("before_count" = "#4d9221", "after_count" = "#91bfdb"),
                    labels = c("Before", "After")) + 
  theme(legend.position = "none")
# coho_top_taxa_plot

coho_top_taxa_3x3 <- plot_grid(coho_top_taxa_plot,
                                  dam_state_legend,
                                  nrow = 2,
                                  rel_heights = c(3, 0.1))
coho_top_taxa_3x3
```

In Coho salmon, chironomidae are the dominant group before and after removal (Figure #). The overall taxa for Coho salmon are certainly dominated by the pre-dam removal state. Few of the taxa identified here have appreciable counts after the removal. This is likely due to the diversification of their diet after removal. 

## IV.E. Question 5. Fish movement

\newpage

# V. Summary and Conclusions

The impact of the removal of two dams from the Elwha River was assessed using physical and ecological endpoints. A number of datasets generated by USGS before, during, and after dam removal were utilized. It is clear that the removal of these dams has a profound impact on river characteristics and salmon behaviors.

--> Stuff about the streamflow and sediment and stuff

  Water quality was not heavily impacted over the time range analyzed, and levels did not exceed unsafe levels. It does appear that nutrient concentrations were elevated after removal. To fully assess how water quality was impacted by dam removal, significantly more timepoints and locations would have needed to be tested.
  The diet of two salmon species, Chinook and Coho, was assessed. Although the data were not able to be normalized, it appears that the diet of both species was diversified by 2014. Chinook salmon appear to be consuming more food that before the dam, but the same is cannot be clearly seen in Coho. Further, the taxa consumed by each species saw some overlap before and after removal, however, new groups were introduced after the dam was removed. Some of the top taxa are shared between the species, such as chironomidae, hilara, and tanypodinae, however, more analysis of these variables would better elucidate the similarities and differences in the diet of Chinook and Coho.

\newpage

# VI. Appendix

## VI.A. Data Sources

## VI.B. References
https://geonarrative.usgs.gov/elwhariverrestoration/
https://projects.seattletimes.com/2016/elwha/

https://www.nps.gov/olym/learn/nature/dam-removal.htm

https://duke.app.box.com/file/2042213070552

https://www.nature.com/articles/s41598-018-30817-8

--- Streamflow 

https://waterdata.usgs.gov/blog/gage_height/ 



--- Nutrient concentrations

https://ei.lehigh.edu/envirosci/watershed/wq/wqbackground/nitratesbg.html#:~:text=in%20a%20watershed?-,1.,blood%20cells%20to%20carry%20oxygen.

chrome-extension://efaidnbmnnnibpcajpcglclefindmkaj/https://osse.ssec.wisc.edu/curriculum/earth/Minifact2_Phosphorus.pdf




