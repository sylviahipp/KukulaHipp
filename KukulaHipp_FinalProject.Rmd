---
title: "Elwha River Dam Removal"
subtitle: "https://github.com/sylviahipp/KukulaHipp"
author: "Sylvia Hipp and Kaitlyn Kukula"
date: "Fall 2025"
output: 
  pdf_document: 
    fig_caption: true
editor_options:
  chunk_output_type: console
markdown: 
  wrap: none
---

\newpage
\tableofcontents 
\newpage
\listoftables 
\listoffigures 
\newpage

```{r, echo = FALSE, include = FALSE}
library(ggplot2)
library(tidyverse)
library(here)
library(lubridate)
library(cowplot)
library(janitor)
library(glue)
library(zoo)
library(tseries)
library(Kendall)
library(knitr)
library(kableExtra)

# check working directory
# here()

kukulahipp_theme <- theme_classic() +
  theme(plot.title = element_text(size = 11, hjust = 0.5, face = "bold"), #Adjust title
        plot.subtitle = element_text(size = 10, hjust = 0.5),
        axis.text.x = element_text(size = 9), # Adjust x-axis values
        axis.text.y = element_text(size = 9), # Adjust y-axis values
        axis.title.x = element_text(size = 10.5), # Adjust x-axis title
        axis.title.y = element_text(size = 10.5), # Adjust y-axis title
        legend.position = "bottom", # Define legend position
        legend.text = element_text(size = 9), # Define legend entry sizes
        legend.title = element_text(size = 9)) # Define legend name sizes

# set theme globally
theme_set(kukulahipp_theme)
```

# I. Introduction

The Elwha River in Washington was the site of one of the largest dam removal projects in United States history. Headwatered in the Olympic Mountains of Washington and flowing to the Strait of Juan de Fuca, the Elwha River originally supported all five Pacific salmon species, steelhead, and other fish populations, along with the Lower Elwha Klallam Tribe. However, the Elwha Dam and Glines Canyon Dam, located 7.9 km and 21.6 km from the river mouth, respectively, blocked fish and sediment passage for more than 100 years (**Figures 1** and **2**). 

```{r echo=FALSE, out.width="50%", fig.align="center", fig.height=2, fig.cap = "Elwha Dam approximately one month into removal (NPS, 2025)"}
knitr::include_graphics("~/KukulaHipp/Images/ElwhaDamRemovalNPS.png")
```

```{r echo=FALSE, out.width="50%", fig.align="center", fig.height=2, fig.cap = "Glines Canyon Dam approximately one month into removal (NPS, 2025)"}
knitr::include_graphics("~/KukulaHipp/Images/GlinesDamRemovalNPS.png")
```

Alongside the concern for fish populations and ecological balance was the concern of rising sea level and the impacts that dams have on coastal erosion and resilience. To restore the passage of fish, preserve the watershed, and protect the people, the Lower Elwha Klallam Tribe sought to remove the dams. They were instrumental in the passing of the Elwha River Ecosystem and Fisheries Restoration Act in 1992, but it took 20 years for dam removal to begin. Finally, from 2011 to 2014, the two dams were removed and impacts were tracked by a team of federal, state, tribal, academic, and community partners. The lower Elwha Dam was fully removed by Spring 2012, and the upper Glines Canyon Dam was removed by August 2014.

Studies were conducted before, during, and after dam removal to understand the shifts in the geomorphology, hydrology, and ecology caused by the removal. Various groups sought to characterize phenomena such as sediment and woody debris dispersion, vegetation growth, invertebrate densities, and fish migration. In this study, we sought to analyze a portion of these impacts and specifically focused on the impacts on streamflow, sediment transport, water quality, and fish diet before, during, and after the dam removal.

The experimental questions of this study are as follows:

- Question 1: How are river discharge and gage height impacted by dam removal?
- Question 2: Is there an observable impact on sediment load and concentration following dam removal?
- Question 3: Is what quality and nutrient availability impacted by the dam removal?
- Question 4: Is there a shift in the types of taxa consumed by Chinook and Coho salmon following dam removal?

\newpage

# II. Dataset Information

We have obtained multiple datasets from the United States Geological Survey (USGS) in regards to the Elwha River dam removals. **For more information on data availability and sources, see Appendix.** These datasets include:

1. Elwha River continuous gage height and discharge levels before, during, and after removal
2. Elwha River daily sediment loads and concentrations during and after dam removal
3. Elwha River water quality at the estuary
4. Chinook and Coho salmon diets, sampled at estuary sites

The relative locations of the Elwha River watershed, communities, USGS monitoring sites, and Elwha and Glines Canyon Dams are depicted in **Figure 3** (map sourced from "Coastal Habitats of the Elwha River, Washington-Biological and Physical Patterns and Processes Prior to Dam Removal", USGS, 2011).

```{r echo=FALSE, out.width="50%", fig.align="center", fig.height=3, fig.cap = "Elwha River watershed, monitoring stations, and dam locations (USGS, 2011)"}
knitr::include_graphics("~/KukulaHipp/Images/ElwhaWatershedMap.png")
```

## II.A. Streamflow Data 

We obtained continuous gage height and discharge data along the Elwha River from USGS's Water Data for the Nation at several USGS monitoring stations along the Elwha River. Data availability for each monitoring station is discussed in-depth in **Section III.A** below. 

Through USGS Water Data for the Nation (https://waterdata.usgs.gov/), continuous data are available at 15-minute increments for a variety of metrics, including discharge, gage height, and water turbidity. A glimpse of the raw data for gage height appears in **Table 1**. We queried data over a 10-year period before, during, and after dam removal (2008–2017).

```{r include=FALSE}
# function to read in raw data
read_usgs_data <- function(parameter, site_no, start, end){
  data_url <- glue(paste0("https://nwis.waterservices.usgs.gov/nwis/iv/?",
                          "sites={site_no}&agencyCd=USGS&",
                          "startDT={start}T00:00:00.000-08:00&",
                          "endDT={end}T23:59:59.999-08:00",
                          "&parameterCd={parameter}&format=rdb"))
  
  param_name <- case_when(parameter == "00065" ~ "gage_height_ft", 
                          parameter == "00060" ~ "discharge_cfs")
  
  df_raw <- read.table(file = data_url, 
                       skip = 26, 
                       header = TRUE, 
                       sep = "\t") %>% 
    tibble() %>% 
    select(-c(6)) %>% 
    rename(!!param_name:=5)
  
  return(df_raw[2:nrow(df_raw),]) # remove first row that doesn't contain data
}
```

```{r include=FALSE}
# Read in Raw Data
# USGS site no.
site_number_mid <- "12045500"
site_number_above <- "12044900"

# data time period
start = ymd("2008-01-01")
end = ymd("2017-12-31")

start_removal <- ymd("2011-09-15")
complete_removal <- ymd("2014-08-26")

# parameters
param_discharge <- "00060"
param_gage_height <- "00065"

# discharge raw data
discharge_mid_raw <- read_usgs_data(param_discharge, site_number_mid, start, end)

# gage height raw data
gage_height_mid_raw <- read_usgs_data(param_gage_height, site_number_mid, start, end)
gage_height_above_raw <- read_usgs_data(param_gage_height, site_number_above, start, end)

```

```{r echo=FALSE}
kable(
  head(gage_height_mid_raw, n = 5), 
  caption = "USGS Continuous Gage Height Raw Data") %>% 
  row_spec(0, bold = TRUE) %>%
  kable_classic(full_width = FALSE)
  
```

## II.B. Sediment Data

Data on sediment load and suspended sediment concentration were obtained from the USGS ScienceBase repository (https://doi.org/10.5066/F7PG1QWC) published in support of the 2018 article by Ritchie, et al. titled "Morphodynamic evolution following sediment release from the world’s largest dam removal" (see **Appendix**). These data were measured and estimated at USGS gaging station #12046260, located on the Elwha River downstream from the Elwha Dam site. Daily data were reported from September 15, 2011 (the start of the Elwha Dam removal) through September 30, 2016 (2 years following the completion of the Glines Canyon Dam removal).

The raw daily sediment data contained 1843 observations and 18 variables measuring daily discharge, sediment concentration, sedimend load and bedload, and sediment discharge. Over this 5 year period, daily suspended sediment concentration data is missing for 10 days. In our analysis, we interpolated these missing data points using linear interpolation. **Table 2** shows a glimpse of the raw data for the daily suspended sediment concentration and load variables, which are of interest for our analysis. 

```{r echo=FALSE, message=FALSE, warning=FALSE, table.attr="style='width:40%;'"}
filepath <- list.files(here("Data/Raw/Elwha_DailySediment_2011_2016/"), 
                       pattern = "\\.csv", full.names = TRUE)

daily_sediment_raw <- read_csv(file = filepath) %>% 
  clean_names() %>% 
  select(day, contains("daily_ssc"), daily_suspended_sediment_load_tonnes)

kable(head(daily_sediment_raw, 5), 
      caption = "Daily Sediment Concentration and Load Raw Data") %>% 
  row_spec(0, bold = TRUE) %>%
  kable_classic(full_width = FALSE)
```

## II.C. Water Quality Data

Water quality data were obtained from USGS ScienceBase repository (https://doi.org/10.5066/F75B00N4) published in support of the 2020 article "Ecological parameters in the Elwha River estuary before and during dam removal" by Foley et al (see **Appendix**). Water quality was measured at two sites before removal (2006-2007) and five sites during/after removal (2013-2014). Concentration and physical characteristic measurements include phosphate, nitrate and nitrile, ammonium, salinity, temperature, turbidity, dissolved oxygen, percent dissolved oxygen, and pH. Turbidity measurements from this datasest were not utilized because sediment analysis is being conducted elsewhere. **Table 3** shows a glimpse of the raw water quality data, though the columns are truncated. In the complete dataset, a column is assigned to each water quality parameter and longitude and latitude are given.
\newpage

```{r echo=FALSE, message=FALSE, warning=FALSE, table.attr="style='width:40%;'"}
estuary_wq_raw <- read.csv("~/KukulaHipp/Data/Raw/Elwha_Estuary_WQ/Elwha_estuary_water_quality_2006-2014.csv")

kable(head(estuary_wq_raw %>% 
             select(Dam.Condition:Site.Name, Phosphate.concentration), 5), 
      caption = "Daily Sediment Concentration and Load Raw Data") %>% 
  row_spec(0, bold = TRUE) %>%
  kable_classic(full_width = FALSE)
```

## II.D. Salmon Diet Data

Data concerning the dietary intake of two salmon species, Chinook and Coho, was obtained from USGS ScienceBase reposity (https://doi.org/10.5066/F75B00N4), published in support of "Ecological parameters in the Elwha River estuary before and during dam removal" by Foley et al (see **Appendix**). In this dataset, the composition of Chinook and Coho salmon diets are made available from stomach content analysis. Fish were collected for sampling throughout 2006-2007 ("Before") and 2013-2014 ("During"). It is important to note that although 2013 and 2014 are considered "During" dam removal, it is important to note that the Elwha Dam, which is lower on the river, was completely removed by 2012. This means that salmon were able to travel up the river more than had been possible for the last 100 years.

For Chinook, 93 and 164 fish were sampled from before and during removal, respectively. For Coho, 23 and 112 fish were sampled from before and during removal, respectively. 193 unique taxa were screened for. **Table 4** shows a glimpse of the dataset, with the columns being truncated for clarity. In the complete dataset, each taxa screened for is assigned a unique column.

```{r echo=FALSE, message=FALSE, warning=FALSE, table.attr="style='width:40%;'"}
salmonid_diet_raw <- read.csv("~/KukulaHipp/Data/Raw/Elwha_estuary_fish_diet/Elwha_estuary_fish_diet.csv")

kable(head(salmonid_diet_raw %>% 
             select(Date:Acari...larva), 5), 
      caption = "Daily Sediment Concentration and Load Raw Data") %>% 
  row_spec(0, bold = TRUE) %>%
  kable_classic(full_width = FALSE)
```

\newpage

# III. Exploratory Analysis 

## III.A. Streamflow

We focused on river discharge and gage height data to analyze changes to river hydrology following dam removal. **Table 2** outlines the availability of river discharge and gage height data at each USGS monitoring site along the Elwha River.

```{r echo=FALSE, warning=FALSE}
usgs_availability <- tibble(
  "Site No." = c("12044900", "12045500", "12046260"), 
  "Relative Location" = c("Above Glines Canyon Dam", "Between Glines Canyon and Elwha Dams", "Below Elwha Dam"), 
  "Discharge" = c("Mar 1994–Sept 2011", "Oct 1989–Present", "Unavailable"), 
  "Gage Height" = c("Oct 2007–Nov 2015", "Oct 2007–Present", "Unavailable")
)

kable(usgs_availability, 
      caption = "Availability of USGS Streamflow Data") %>% 
  row_spec(0, align = "c", bold = TRUE) %>% 
  add_header_above(
    header = c(" " = 2, "Dates Available" = 2), align = "c", bold = TRUE) %>% 
  kable_classic()
```

Our goal is to analyze Elwha River streamflow before, during, and after the dam removal, which occurred over the period 2011–2014. Therefore, based on data availability, we downloaded discharge data from USGS site #12045500 and gage height data from USGS sites #12044900 and #12045500. We pulled continuous data over the period 2008–2017 (as available) to capture a 10-year window surrounding the dam removal. 

```{r include = FALSE}
# Data Cleaning
wrangle_usgs_data <- function(df_raw, param){
  avg_var = paste0("avg_", param)
  
  df <- df_raw %>% 
    mutate(datetime = as.POSIXct(datetime, tz = "PST"),
           date = as.Date(datetime), 
           !!param := as.numeric(!!sym(param)), 
           site_location = case_when(site_no == "12044900" ~ "above", 
                                     site_no == "12045500" ~ "mid"), 
           site_no = factor(site_no, levels = c("12045500", "12044900"))) %>% 
    group_by(date, site_no, site_location) %>% 
    summarize(!!avg_var := mean(!!sym(param), na.rm = TRUE)) %>% 
    ungroup() %>% 
    mutate(period = case_when(date < start_removal ~ "before", 
                              date <= complete_removal ~ "during", 
                              date > complete_removal ~ "after"))
  
  return(df)
}

gage_height_df <- bind_rows(
  wrangle_usgs_data(gage_height_mid_raw, "gage_height_ft"), 
  wrangle_usgs_data(gage_height_above_raw, "gage_height_ft")) 

discharge_df <- wrangle_usgs_data(discharge_mid_raw, "discharge_cfs")

```

We plotted the time series data to get a sense of how discharge and gage height trend over time. **Figures 4** and **5** show daily average discharge (in cubic feet per second) and gage height (in feet), respectively, measured at the USGS monitoring sites with available data over 2008–2017. Daily averages were calculated over all 15-minute increments recorded each day. Over this 10-year period, discharge data were missing for 130 days. For our analysis, we interpolated discharge on these days using linear interpolation.

```{r echo=FALSE, fig.align='center', fig.height=3, fig.cap='Elwha River Daily Average Discharge at USGS Site 12045500 (2008–2017)'}

# fig.cap='Elwha River Average Daily Discharge at USGS Site #12045500 (2008–2017)'
# Figure: Discharge Data Site 12045500
discharge_explore_plot <- ggplot() + 
  geom_rect(aes(xmin = start_removal, xmax = complete_removal, 
                ymin = 0, ymax = 15000), alpha = 0.4, fill = "grey") +
  geom_line(data = discharge_df, aes(x = date, y = avg_discharge_cfs)) + 
  annotate(geom = "text", x = ymd("2013-03-01"), y = 14000, size = 2.5,
           label = "Dam Removal Period\n(Sept 2011-Aug 2014)") + 
  scale_y_continuous(labels = scales::comma) + 
  scale_x_date(expand=c(0,0)) +
  labs(x = "Year", 
       y = "Daily Average Discharge (cfs)", 
       title = "Daily Average Discharge Before, During, and After Dam Removal",
       subtitle = "Elwha River, USGS Station 12045500, 2008–2017")

discharge_explore_plot
```
\newpage

```{r echo=FALSE, warning=FALSE, fig.align='center', fig.height=6.5, fig.cap='Elwha River Daily Average Gage Height (2008–2017)'}
# Figure: Gage Height Data Sites 12045500 and 12044900
baseplot <- function(ymin, ymax, vjust){
  plot <- ggplot() + 
    geom_rect(aes(xmin = start_removal, xmax = complete_removal, 
                  ymin = ymin, ymax = ymax), alpha = 0.4, fill = "grey") + 
    annotate(geom = "text", x = ymd("2013-03-01"), y = ymax-vjust, size = 2.5,
             label = "Dam Removal Period\n(Sept 2011-Aug 2014)") +
    scale_x_date(expand=c(0,0)) +
    scale_y_continuous(limits = c(ymin, ymax)) +
    scale_color_manual(values = c("12045500" = "#1b9e77", "12044900" = "#d95f02"),
                       limits = c("12045500", "12044900"),
                       drop = FALSE) + 
    labs(x = NULL, 
         y = "Daily Average Gage Height (ft)", 
         color = "USGS Site No.")
 return(plot) 
}

gage_height_explore_plot <- baseplot(0, 600, 100) + 
  geom_line(data = gage_height_df, 
            aes(x = date, y = avg_gage_height_ft, color = site_no)) +
  theme(legend.position = "None") + 
  labs(title = "Daily Average Gage Height Before, During, and After Dam Removal",
       subtitle = "Elwha River, USGS Station 12045500, 2008–2017")

gage_height_mid_only <- baseplot(9, 20, 1) + 
  geom_line(data = gage_height_df, #%>% filter(site_no == "12045500"), 
            aes(x = date, y = avg_gage_height_ft, color = site_no)) + 
  labs(x = "Year")

plot_grid(gage_height_explore_plot, gage_height_mid_only, 
          labels = c("A", "B"),
          nrow = 2, rel_heights = c(0.45, 0.55))

```

As is apparent in **Figure 5.A**, gage height at USGS Site #12044900 (located upriver from the Elwha Dam) spiked immediately from 10 ft to nearly 600 ft at the start of the Elwha Dam removal in September 2011. We hypothesize that this spike is due to a change in the zero level used to measure relative stream stage. Because the cause and characterization of this spike is unknown, we chose to exclude observations from this location and focus only on USGS Site #12045500 for our analysis of gage height. A time series analysis of the streamflow data collected at this monitoring site is discussed further in **Section IV.A** below.

\newpage

## III.B. Sediment

Over the dams' 100-year lifetime, nearly 30 million tonnes of sediment had been trapped behind the Elwha and Glines Canyon dams (Coastal Watershed Institute, 2022). Removal of the dams along the Elwha River released over 10 million tonnes of sediment trapped in the dams' reservoirs (East et al., 2015). Our goal is to use suspended sediment concentration and load data measured downstream of both dams (USGS Site #12046260) to understand how dam removal changed the river's sediment budget, therefore impacting river morphology.  

**Figure 6.A** shows the distribution of daily suspended sediment concentrations observed during and after dam removal, with values ranging from 0.22 to 13,819 mg/L. **Figure 6.B** shows the distribution of daily sediment load, with values ranging from 0.1 to 429,807 tonnes.  

```{r include=FALSE}
daily_sediment_df <- daily_sediment_raw %>% 
  mutate(date = mdy(day)) %>% 
  arrange(date) %>% 
  select(date, daily_ssc_mg_l, daily_suspended_sediment_load_tonnes) %>% 
  mutate(
    daily_ssc_mg_l = zoo::na.approx(daily_ssc_mg_l),   # linear approximation
    # group concentrations into buckets
    concentration_mgL = case_when(daily_ssc_mg_l < 100 ~ "<100", 
                                  daily_ssc_mg_l %>% between(100, 499.99) ~ "100–499",
                                  daily_ssc_mg_l %>% between(500, 999.99) ~ "500–999",
                                  daily_ssc_mg_l %>% between(1000, 4999.99) ~ "1,000–4,999", 
                                  daily_ssc_mg_l %>% between(5000, 9999.99) ~ "5,000–9,999",
                                  daily_ssc_mg_l >= 10000 ~ ">10,000"),
    concentration_mgL = factor(concentration_mgL,
                               levels = c("<100", "100–499", "500–999", 
                                          "1,000–4,999", "5,000–9,999", ">10,000")))
```

```{r echo=FALSE, fig.cap='Distribution of Daily Suspended Sediment Concentration and Load at USGS Site 12046260 (2011–2016)', fig.height=5}
ssc_hist <- ggplot(daily_sediment_df) + 
  geom_histogram(aes(daily_ssc_mg_l), 
                 bins = 50) + 
  scale_x_continuous(breaks = seq(0, 14000, by = 3500), 
                     labels = scales::comma) + 
  labs(x = "Suspended Sediment Concentration (mg/L)", 
       y = "Days Observed", 
       title = "Distribution of Daily Suspended Sediment Concentration and Load", 
       subtitle = "Elwha River, USGS Station 12046260, 2011–2016")

load_hist <- ggplot(daily_sediment_df) + 
  geom_histogram(aes(daily_suspended_sediment_load_tonnes/1000), 
                 bins = 50) + 
  scale_y_continuous(labels = scales::comma) + 
  labs(x = "Suspended Sediment Load (000s Tonnes)", 
       y = "Days Observed")

plot_grid(ssc_hist, load_hist, nrow = 2, ncol = 1, 
          labels = c("A", "B"), rel_heights = c(0.52, 0.48))
```

**Figure 7** shows suspended sediment concentration and load measured downstream both dams over the five-year period during and after dam removal. Because of the wide range of observed concentrations, the data are grouped into buckets to better visualize a trend in sediment concentration over time. Each bar in **Figure 7.B** represents a week during the five-year period and is colored according to the suspended sediment concentrations recorded throughout the week. Sediment concentrations align closely with peaks in sediment load shown in **Figure 7.A**. 
\newpage

```{r echo=FALSE, fig.cap='Trends in Daily Sediment Load and Concentration at USGS Site 12046260 (2011–2016)', fig.height=6, message=FALSE, warning=FALSE}
# get composition of daily concentration for each week
weekly_conc_to_plot <- daily_sediment_df %>% 
  # group dates into weeks (starting on Sunday of each week)
  mutate(weekday = as.POSIXlt(date)$wday,   
         week = date - weekday) %>% 
  group_by(week, concentration_mgL) %>% 
  summarize(n_days = n()) %>% 
  ungroup() %>% 
  mutate(pct_of_week = n_days/7)

# plot daily sediment load
sediment_load_plot <- ggplot() + 
  geom_line(data = daily_sediment_df, 
            aes(x = date, y = daily_suspended_sediment_load_tonnes/1000)) + 
  geom_vline(xintercept = start_removal, color = "red", linetype = 2, linewidth = 0.75) + 
  geom_vline(xintercept = complete_removal, color = "red", linetype = 2, linewidth = 0.75) +
  geom_label(aes(x = start_removal+300, y = 500, 
                 label = "Start of Elwha Dam Removal"), 
             fill = "white", size = 3) +
  geom_label(aes(x = complete_removal, y = 500, 
                 label = "Completion of Glines Canyon Dam Removal"), 
             fill = "white", size = 3) +
  scale_x_date(expand = c(0,0), 
               limits = c(start_removal-20, max(daily_sediment_df$date))) + 
  labs(x = NULL, 
       y = "Suspended Sediment Load\n(000s tonnes)", 
       title = "Daily Sediment Load and Concentration During and After Dam Removal", 
       subtitle = "Elwha River, USGS Station 12046260, 2011–2016\n")

# plot weekly SS concentration
sediment_conc_plot <- ggplot() + 
  geom_col(data = weekly_conc_to_plot, 
           aes(x = week, y = pct_of_week, fill = concentration_mgL), width = 8) + 
  geom_vline(xintercept = start_removal, color = "red", linetype = 2, linewidth = 0.75) +
  geom_vline(xintercept = complete_removal, color = "red", linetype = 2, linewidth = 0.75) + 
  scale_fill_manual(values = c("#ECAD7C","#DE924F", "#B25900", 
                               "#964B00", "#663300", "#433100")) + 
  scale_x_date(expand = c(0,0), 
               limits = c(start_removal-20, max(daily_sediment_df$date)))+
  scale_y_continuous(labels = scales::percent) + 
  labs(x = "Year", 
       y = "Share of Week", 
       fill = "Sediment Concentration (mg/L)")

plot_grid(plotlist = list(sediment_load_plot, sediment_conc_plot), 
          ncol = 1, nrow = 2, 
          rel_heights = c(0.45, 0.55))
```

**Figure 7** shows that suspended sediment concentration measured at this point below both dams was sustained at levels greater than 100 mg/L for weeks or months at a time during all three years of the removal period. During both periods during and after removal, suspended sediment load peaks in winter months during winter high flows and snow melt (Ritchie et al., 2018). In **Section IV.B**, we analyze whether suspended sediment load and concentration levels were significantly heightened during dam removal relative to levels after dam removal. 
\newpage

## III.C. Water Quality

```{r echo = FALSE, warning = FALSE}
estuary_wq_raw <- estuary_wq_raw %>% mutate(Date = mdy(Date.Collected))
#colnames(estuary_wq_raw)
#unique(estuary_wq_raw$Site.Name)
```

To better understand the individual trends and suitability of this data for analysis, each parameter was plotted against time. **Figure 8** displays an example of these plot for nitrate concentrations.

``` {r echo = FALSE, warning = FALSE, fig.height = 3, fig.cap = "Measured nitrate/nitrile concentration [uM] before and after dam removal"}

estuary_wq_nitrate <- estuary_wq_raw %>%
  mutate(Nitrate = as.numeric(Nitrate...Nitrite.concentration)) %>%
  select(Site.Name:Longitude, Nitrate, Date)

# Create a before plot
nitrate_before_plot <- ggplot(estuary_wq_nitrate %>% filter(Date <= "2007-08-30")) +
  geom_point(aes(x = Date, y = Nitrate, color = Site.Name)) +
  geom_line(aes(x = Date, y = Nitrate, color = Site.Name), linewidth = 0.75) +
  scale_x_date(limits = c(as.Date("2006-06-01"), as.Date("2007-09-01")),
               breaks = "3 month", date_labels = "%b %Y") +
  ylim(c(0,20)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "none") +
  labs(x = NULL, y = expression(paste("Nitrate [", mu, "M]"))) +
  scale_color_manual(values = c("ES1" = "#1b9e77", "ES2" = "#d95f02"))

# Create an after plot
nitrate_after_plot <- ggplot(estuary_wq_nitrate %>% filter(Date > "2007-08-30")) +
  geom_point(aes(x = Date, y = Nitrate, color = Site.Name)) +
  geom_line(aes(x = Date, y = Nitrate, color = Site.Name), linewidth = 0.75) +
  scale_x_date(limits = c(as.Date("2013-06-28"), as.Date("2014-10-12")),
               breaks = "3 month", date_labels = "%b %Y") +
  ylim(c(0,20)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none") +
  labs(x = NULL, y = NULL) +
  scale_color_manual(values = c("ES1" = "#1b9e77","ES2" = "#d95f02",
                                "IEC" = "#7570b3", "WESC1" = "#e7298a",
                                "WESC2" = "#66a61e"))
# Create a legend plot
nitrate_legend <- get_legend(
  ggplot(estuary_wq_nitrate %>% filter(Date >= "2007-08-30")) +
  geom_point(aes(x = Date, y = Nitrate, color = Site.Name)) +
    scale_color_manual(values = c("ES1" = "#1b9e77","ES2" = "#d95f02",
                                "IEC" = "#7570b3", "WESC1" = "#e7298a",
                                "WESC2" = "#66a61e")) +
    labs(color = "Site"))

# Create a window for the before and after plots
nitrate_plot <- plot_grid(nitrate_before_plot, nitrate_after_plot)

# Create a window for the title
nitrate_title <- ggplot() + 
  labs(title = "Nitrate/Nitrile concentrations") +
  theme(plot.subtitle = element_text(hjust = 0.5))

# Generate the final plot with title, data, and legend
nitrate_plot_legend <- plot_grid(nitrate_title, nitrate_plot, nitrate_legend, 
                                 nrow = 3, rel_heights = c(0.1, 0.8, 0.1))
# Display plot
nitrate_plot_legend
```

``` {r include = FALSE,  fig.cap = "Measured phosphate [uM] before and after dam removal"}

estuary_wq_phos <- estuary_wq_raw %>%
  mutate(Phosphate = as.numeric(Phosphate.concentration)) %>%
  select(Site.Name:Longitude, Phosphate, Date)

# Create a before plot
phos_before_plot <- ggplot(estuary_wq_phos %>% filter(Date <= "2007-08-30")) +
  geom_point(aes(x = Date, y = Phosphate, color = Site.Name)) +
  geom_line(aes(x = Date, y = Phosphate, color = Site.Name), linewidth = 0.75) +
  scale_x_date(limits = c(as.Date("2006-06-01"), as.Date("2007-09-01")),
               breaks = "3 month", date_labels = "%b %Y") +
  ylim(c(0,0.75)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "none") +
  labs(x = NULL, y = expression(paste("Phosphate [", mu, "M]"))) +
  scale_color_manual(values = c("ES1" = "#1b9e77", "ES2" = "#d95f02"))

# Create an after plot
phos_after_plot <- ggplot(estuary_wq_phos %>% filter(Date > "2007-08-30")) +
  geom_point(aes(x = Date, y = Phosphate, color = Site.Name)) +
  geom_line(aes(x = Date, y = Phosphate, color = Site.Name), linewidth = 0.75) +
  scale_x_date(limits = c(as.Date("2013-06-28"), as.Date("2014-10-12")),
               breaks = "3 month", date_labels = "%b %Y") +
  ylim(c(0,0.75)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none") +
  labs(x = NULL, y = NULL) +
  scale_color_manual(values = c("ES1" = "#1b9e77","ES2" = "#d95f02",
                                "IEC" = "#7570b3", "WESC1" = "#e7298a",
                                "WESC2" = "#66a61e"))
# Create a legend plot
phos_legend <- get_legend(
  ggplot(estuary_wq_phos %>% filter(Date >= "2007-08-30")) +
  geom_point(aes(x = Date, y = Phosphate, color = Site.Name)) +
    scale_color_manual(values = c("ES1" = "#1b9e77","ES2" = "#d95f02",
                                "IEC" = "#7570b3", "WESC1" = "#e7298a",
                                "WESC2" = "#66a61e")) +
    labs(color = "Site"))

# Create a window for the before and after plots
phos_plot <- plot_grid(phos_before_plot, phos_after_plot)

# Create a window for the title
phos_title <- ggplot() + 
  labs(title = "Phosphate concentrations") +
  theme(plot.subtitle = element_text(hjust = 0.5))

# Generate the final plot with title, data, and legend
phos_plot_legend <- plot_grid(phos_title, phos_plot, phos_legend, 
                                 nrow = 3, rel_heights = c(0.1, 0.8, 0.1))
# Display plot
#phos_plot_legend
```

``` {r include = FALSE, warning = FALSE, fig.cap = "Measured ammonium concentration [uM] before and after dam removal"}

estuary_wq_amm <- estuary_wq_raw %>%
  mutate(Ammonium = as.numeric(Ammonium.concentration)) %>%
  select(Site.Name:Longitude, Ammonium, Date)

# Create a before plot
amm_before_plot <- ggplot(estuary_wq_amm %>% filter(Date <= "2007-08-30")) +
  geom_point(aes(x = Date, y = Ammonium, color = Site.Name)) +
  geom_line(aes(x = Date, y = Ammonium, color = Site.Name), linewidth = 0.75) +
  scale_x_date(limits = c(as.Date("2006-06-01"), as.Date("2007-09-01")),
               breaks = "3 month", date_labels = "%b %Y") +
  ylim(c(0,20)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "none") +
  labs(x = NULL, y = expression(paste("Ammonium [", mu, "M]"))) +
  scale_color_manual(values = c("ES1" = "#1b9e77", "ES2" = "#d95f02"))

# Create an after plot
amm_after_plot <- ggplot(estuary_wq_amm %>% filter(Date > "2007-08-30")) +
  geom_point(aes(x = Date, y = Ammonium, color = Site.Name)) +
  geom_line(aes(x = Date, y = Ammonium, color = Site.Name), linewidth = 0.75) +
  scale_x_date(limits = c(as.Date("2013-06-28"), as.Date("2014-10-12")),
               breaks = "3 month", date_labels = "%b %Y") +
  ylim(c(0,20)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none") +
  labs(x = NULL, y = NULL) +
  scale_color_manual(values = c("ES1" = "#1b9e77","ES2" = "#d95f02",
                                "IEC" = "#7570b3", "WESC1" = "#e7298a",
                                "WESC2" = "#66a61e"))
# Create a legend plot
amm_legend <- get_legend(
  ggplot(estuary_wq_amm %>% filter(Date >= "2007-08-30")) +
  geom_point(aes(x = Date, y = Ammonium, color = Site.Name)) +
    scale_color_manual(values = c("ES1" = "#1b9e77","ES2" = "#d95f02",
                                "IEC" = "#7570b3", "WESC1" = "#e7298a",
                                "WESC2" = "#66a61e")) +
    labs(color = "Site"))

# Create a window for the before and after plots
amm_plot <- plot_grid(amm_before_plot, amm_after_plot)

# Create a window for the title
amm_title <- ggplot() + 
  labs(title = "Ammonium concentrations") +
  theme(plot.subtitle = element_text(hjust = 0.5))

# Generate the final plot with title, data, and legend
amm_plot_legend <- plot_grid(amm_title, amm_plot, amm_legend, 
                                 nrow = 3, rel_heights = c(0.1, 0.8, 0.1))
# Display plot
#amm_plot_legend
```

``` {r include = FALSE, fig.cap = "Measured salinity [PSU] before and after dam removal"}

estuary_wq_salinity <- estuary_wq_raw %>%
  mutate(Salinity = as.numeric(Salinity)) %>%
  select(Site.Name:Longitude, Salinity, Date)

# Create a before plot
salinity_before_plot <- ggplot(estuary_wq_salinity %>% filter(Date <= "2007-08-30")) +
  geom_point(aes(x = Date, y = Salinity, color = Site.Name)) +
  geom_line(aes(x = Date, y = Salinity, color = Site.Name), linewidth = 0.75) +
  scale_x_date(limits = c(as.Date("2006-06-01"), as.Date("2007-09-01")),
               breaks = "3 month", date_labels = "%b %Y") +
  ylim(c(0,0.75)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "none") +
  labs(x = NULL, y = expression(paste("Salinity [units]"))) +
  scale_color_manual(values = c("ES1" = "#1b9e77", "ES2" = "#d95f02"))

# Create an after plot
salinity_after_plot <- ggplot(estuary_wq_salinity %>% filter(Date > "2007-08-30")) +
  geom_point(aes(x = Date, y = Salinity, color = Site.Name)) +
  geom_line(aes(x = Date, y = Salinity, color = Site.Name), linewidth = 0.75) +
  scale_x_date(limits = c(as.Date("2013-06-28"), as.Date("2014-10-12")),
               breaks = "3 month", date_labels = "%b %Y") +
  ylim(c(0,0.75)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none") +
  labs(x = NULL, y = NULL) +
  scale_color_manual(values = c("ES1" = "#1b9e77","ES2" = "#d95f02",
                                "IEC" = "#7570b3", "WESC1" = "#e7298a",
                                "WESC2" = "#66a61e"))
# Create a legend plot
salinity_legend <- get_legend(
  ggplot(estuary_wq_salinity %>% filter(Date >= "2007-08-30")) +
  geom_point(aes(x = Date, y = Salinity, color = Site.Name)) +
    scale_color_manual(values = c("ES1" = "#1b9e77","ES2" = "#d95f02",
                                "IEC" = "#7570b3", "WESC1" = "#e7298a",
                                "WESC2" = "#66a61e")) +
    labs(color = "Site"))

# Create a window for the before and after plots
salinity_plot <- plot_grid(salinity_before_plot, salinity_after_plot)

# Create a window for the title
salinity_title <- ggplot() + 
  labs(title = "Salinity") +
  theme(plot.subtitle = element_text(hjust = 0.5))

# Generate the final plot with title, data, and legend
salinity_plot_legend <- plot_grid(salinity_title, salinity_plot, salinity_legend, 
                                 nrow = 3, rel_heights = c(0.1, 0.8, 0.1))
# Display plot
#salinity_plot_legend
```

``` {r include = FALSE, fig.cap = "Measured temperature [deg C] before and after dam removal"}

estuary_wq_temperature <- estuary_wq_raw %>%
  mutate(Temperature = as.numeric(Temperature)) %>%
  select(Site.Name:Longitude, Temperature, Date)

# Create a before plot
temp_before_plot <- ggplot(estuary_wq_temperature %>% filter(Date <= "2007-08-30")) +
  geom_point(aes(x = Date, y = Temperature, color = Site.Name)) +
  geom_line(aes(x = Date, y = Temperature, color = Site.Name), linewidth = 0.75) +
  scale_x_date(limits = c(as.Date("2006-06-01"), as.Date("2007-09-01")),
               breaks = "3 month", date_labels = "%b %Y") +
  ylim(c(0,15)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "none") +
  labs(x = NULL, y = expression(paste("Salinity [units]"))) +
  scale_color_manual(values = c("ES1" = "#1b9e77", "ES2" = "#d95f02"))

# Create an after plot
temp_after_plot <- ggplot(estuary_wq_temperature %>% filter(Date > "2007-08-30")) +
  geom_point(aes(x = Date, y = Temperature, color = Site.Name)) +
  geom_line(aes(x = Date, y = Temperature, color = Site.Name), linewidth = 0.75) +
  scale_x_date(limits = c(as.Date("2013-06-28"), as.Date("2014-10-12")),
               breaks = "3 month", date_labels = "%b %Y") +
  ylim(c(0,15)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none") +
  labs(x = NULL, y = NULL) +
  scale_color_manual(values = c("ES1" = "#1b9e77","ES2" = "#d95f02",
                                "IEC" = "#7570b3", "WESC1" = "#e7298a",
                                "WESC2" = "#66a61e"))
# Create a legend plot
temp_legend <- get_legend(
  ggplot(estuary_wq_temperature %>% filter(Date >= "2007-08-30")) +
  geom_point(aes(x = Date, y = Temperature, color = Site.Name)) +
    scale_color_manual(values = c("ES1" = "#1b9e77","ES2" = "#d95f02",
                                "IEC" = "#7570b3", "WESC1" = "#e7298a",
                                "WESC2" = "#66a61e")) +
    labs(color = "Site"))

# Create a window for the before and after plots
temp_plot <- plot_grid(temp_before_plot, temp_after_plot)

# Create a window for the title
temp_title <- ggplot() + 
  labs(title = "Temperature") +
  theme(plot.subtitle = element_text(hjust = 0.5))

# Generate the final plot with title, data, and legend
temp_plot_legend <- plot_grid(temp_title, temp_plot, temp_legend, 
                                 nrow = 3, rel_heights = c(0.1, 0.8, 0.1))
# Display plot
#temp_plot_legend
```

``` {r include = FALSE, fig.cap = "Measured dissolved oxygen [mg/L] before and after dam removal"}
estuary_wq_do <- estuary_wq_raw %>%
  mutate(Dissolved_Oxygen = as.numeric(Dissolved.oxygen)) %>%
  select(Site.Name:Longitude, Dissolved_Oxygen, Date)

# Create a before plot
do_before_plot <- ggplot(estuary_wq_do %>% filter(Date <= "2007-08-30")) +
  geom_point(aes(x = Date, y = Dissolved_Oxygen, color = Site.Name)) +
  geom_line(aes(x = Date, y = Dissolved_Oxygen, color = Site.Name), linewidth = 0.75) +
  scale_x_date(limits = c(as.Date("2006-06-01"), as.Date("2007-09-01")),
               breaks = "3 month", date_labels = "%b %Y") +
  ylim(c(0,15)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "none") +
  labs(x = NULL, y = expression(paste("Dissolved Oxygen [mg/L]"))) +
  scale_color_manual(values = c("ES1" = "#1b9e77", "ES2" = "#d95f02"))

# Create an after plot
do_after_plot <- ggplot(estuary_wq_do %>% filter(Date > "2007-08-30")) +
  geom_point(aes(x = Date, y = Dissolved_Oxygen, color = Site.Name)) +
  geom_line(aes(x = Date, y = Dissolved_Oxygen, color = Site.Name), linewidth = 0.75) +
  scale_x_date(limits = c(as.Date("2013-06-28"), as.Date("2014-10-12")),
               breaks = "3 month", date_labels = "%b %Y") +
  ylim(c(0,15)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none") +
  labs(x = NULL, y = NULL) +
  scale_color_manual(values = c("ES1" = "#1b9e77","ES2" = "#d95f02",
                                "IEC" = "#7570b3", "WESC1" = "#e7298a",
                                "WESC2" = "#66a61e"))
# Create a legend plot
do_legend <- get_legend(
  ggplot(estuary_wq_do %>% filter(Date >= "2007-08-30")) +
  geom_point(aes(x = Date, y = Dissolved_Oxygen, color = Site.Name)) +
    scale_color_manual(values = c("ES1" = "#1b9e77","ES2" = "#d95f02",
                                "IEC" = "#7570b3", "WESC1" = "#e7298a",
                                "WESC2" = "#66a61e")) +
    labs(color = "Site"))

# Create a window for the before and after plots
do_plot <- plot_grid(do_before_plot, do_after_plot)

# Create a window for the title
do_title <- ggplot() + 
  labs(title = "Dissolved Oxygen") +
  theme(plot.subtitle = element_text(hjust = 0.5))

# Generate the final plot with title, data, and legend
do_plot_legend <- plot_grid(do_title, do_plot, do_legend, 
                                 nrow = 3, rel_heights = c(0.1, 0.8, 0.1))
# Display plot
#do_plot_legend
```

``` {r include = FALSE, fig.cap = "Measured pH [units] before and after dam removal"}

estuary_wq_ph <- estuary_wq_raw %>%
  mutate(pH = as.numeric(pH)) %>%
  select(Site.Name:Longitude, pH, Date)

# Create a before plot
ph_before_plot <- ggplot(estuary_wq_ph %>% filter(Date <= "2007-08-30")) +
  geom_point(aes(x = Date, y = pH, color = Site.Name)) +
  geom_line(aes(x = Date, y = pH, color = Site.Name), linewidth = 0.75) +
  scale_x_date(limits = c(as.Date("2006-06-01"), as.Date("2007-09-01")),
               breaks = "3 month", date_labels = "%b %Y") +
  ylim(c(0,10)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "none") +
  labs(x = NULL, y = expression(paste("Dissolved Oxygen [units]"))) +
  scale_color_manual(values = c("ES1" = "#1b9e77", "ES2" = "#d95f02"))

# Create an after plot
ph_after_plot <- ggplot(estuary_wq_ph %>% filter(Date > "2007-08-30")) +
  geom_point(aes(x = Date, y = pH, color = Site.Name)) +
  geom_line(aes(x = Date, y = pH, color = Site.Name), linewidth = 0.75) +
  scale_x_date(limits = c(as.Date("2013-06-28"), as.Date("2014-10-12")),
               breaks = "3 month", date_labels = "%b %Y") +
  ylim(c(0,10)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none") +
  labs(x = NULL, y = NULL) +
  scale_color_manual(values = c("ES1" = "#1b9e77","ES2" = "#d95f02",
                                "IEC" = "#7570b3", "WESC1" = "#e7298a",
                                "WESC2" = "#66a61e"))
# Create a legend plot
ph_legend <- get_legend(
  ggplot(estuary_wq_ph %>% filter(Date >= "2007-08-30")) +
  geom_point(aes(x = Date, y = pH, color = Site.Name)) +
    scale_color_manual(values = c("ES1" = "#1b9e77","ES2" = "#d95f02",
                                "IEC" = "#7570b3", "WESC1" = "#e7298a",
                                "WESC2" = "#66a61e")) +
    labs(color = "Site"))

# Create a window for the before and after plots
ph_plot <- plot_grid(ph_before_plot, ph_after_plot)

# Create a window for the title
ph_title <- ggplot() + 
  labs(title = "pH") +
  theme(plot.subtitle = element_text(hjust = 0.5))

# Generate the final plot with title, data, and legend
ph_plot_legend <- plot_grid(ph_title, ph_plot, ph_legend, 
                                 nrow = 3, rel_heights = c(0.1, 0.8, 0.1))
# Display plot
ph_plot_legend
```

```{r include = FALSE}

# Dataset legend (grabbed from nitrate subset)
estuary_wq_legend <- get_legend(
  ggplot(estuary_wq_nitrate %>% filter(Date >= "2007-08-30")) +
  geom_point(aes(x = Date, y = Nitrate, color = Site.Name)) +
    scale_color_manual(values = c("ES1" = "#1b9e77","ES2" = "#d95f02",
                                "IEC" = "#7570b3", "WESC1" = "#e7298a",
                                "WESC2" = "#66a61e")) +
    labs(color = "Site"))

# Dataset title
dataset_title <- ggplot() + 
  labs(title = "Water Quality at the Elwha River Estuary Before and During Dam Removal",
       subtitle = "Dam removal: 2011 - 2014") +
  theme(plot.subtitle = element_text(hjust = 0.5))
```

Based on this data exploration, the parameters with useful data are nitrate/nitrile concentration, phosphate concentration, ammonium concentration, and dissolved oxygen. Further analysis of these parameters is included below in **Section IV.C.** The parameters not selected for further analysis include salinity, temperature, and pH, and are represented below (**Figure 9**). This dataset is limited by the sampling density and locations, specifically by the lack of sampling at all sites across time points. 

``` {r warning = FALSE, echo = FALSE, fig.cap = "Water quality parameters not selected for further analysis", fig.height=6}
estuary_wq_rejects_plot <- plot_grid(dataset_title,
                             salinity_title, salinity_plot,
                             temp_title, temp_plot,
                             ph_title, ph_plot,
                             estuary_wq_legend,
                             nrow = 8, rel_heights = c(3, 1, 6, 1, 6, 1, 6, 0.5))
estuary_wq_rejects_plot
```

\newpage

## III.D. Salmon Diet

``` {r include = FALSE}
salmonid_diet_raw <- read.csv("~/KukulaHipp/Data/Raw/Elwha_estuary_fish_diet/Elwha_estuary_fish_diet.csv") %>%
  mutate(Date = mdy(Date),
         Year = as.numeric(Year)) %>% 
  janitor::clean_names()

# Summed all taxa consumed by salmon type in a year
salmonid_diet_processed <- salmonid_diet_raw %>%
  group_by(year, fish) %>% 
  summarise(across(c(acari_larva:trichoptera_pupa), ~sum(., na.rm = TRUE))) %>% 
  ungroup() %>% 
  pivot_longer(c(acari_larva:trichoptera_pupa)) %>%
  pivot_wider(id_cols = c("fish", "name"),
              names_from = "year",
              values_from = "value",
              names_prefix = "value_") %>% 
  mutate(taxa = str_extract(name, "^.+\\_") %>% str_remove_all("\\_")) %>% 
  group_by(fish, taxa) %>% 
  summarise(across(c(value_2006:value_2014), ~sum(., na.rm = TRUE))) %>% 
  ungroup() %>% 
  mutate(before_count = rowSums(across(value_2006:value_2007)),
         after_count = rowSums(across(value_2013:value_2014)),
         total_count = rowSums(across(before_count:after_count)))

#colnames(salmonid_diet_raw)

# What dates did they sample on
#unique(salmonid_diet_raw$date)

# Create a data frame for Chinook salmon diet
chinook_diet <- salmonid_diet_processed %>%
  filter(fish == "Chinook") %>% 
  mutate(value_2006 = as.numeric(value_2006),
         value_2007 = as.numeric(value_2007),
         value_2013 = as.numeric(value_2013),
         value_2014 = as.numeric(value_2014))

# Create a data frame for Coho salmon diet
coho_diet <- salmonid_diet_processed %>% filter(fish == "Coho") %>% 
  mutate(value_2006 = as.numeric(value_2006),
         value_2007 = as.numeric(value_2007),
         value_2013 = as.numeric(value_2013),
         value_2014 = as.numeric(value_2014))
```

A dataset that contained the total counts of each taxa count by year, dam condition, and total observations was created. Some taxa are broken into distinct groups, such as Acari, which have entries for both larva and terrestrial (unknown). In the processed dataset, taxa from unique locations or growth stages were combined. In this example, Acari larva and terrestrial (unknown) were summed into a final "Acari" group. **Table 4** shows a glimpse of the Chinook processed dataset, though the counts per year are omitted from this view.

```{r echo=FALSE, message=FALSE, warning=FALSE, table.attr="style='width:40%;'"}
kable(head(chinook_diet %>%
             select(fish:taxa, before_count:total_count), 5), 
      caption = "Selected rocessed data for Chinook salmon diet") %>% 
  row_spec(0, bold = TRUE) %>%
  kable_classic(full_width = FALSE)
```

A limitation of this study is that the number of fish surveyed was not used to normalize the data, so this dataset does not contain relative abundance of consumption across the species as a whole. As the number of times samples were collected greatly increased during the dam removal, this dataset cannot be used to determine the amount of food consumed per fish without further normalization. As such, the goal of this portion of the study is to determine how the dam removal impacted composition of diet, and not abundance of consumption.

\newpage

# IV. Analysis

## IV.A. Question 1. How are river discharge and gage height impacted by dam removal?

**Figures 4** and **5** above depict daily average discharge and gage height levels recorded at USGS Site #12045500 from 2008 to 2017. **Table 7** summarizes the overall average gage height and discharge levels before, during, and after removal.

```{r echo=FALSE}
# include only 12045500
gage_height_df <- gage_height_df %>% filter(site_no == "12045500") 

discharge_before <- discharge_df %>% filter(period == "before") %>% pull(avg_discharge_cfs)
discharge_during <- discharge_df %>% filter(period == "during") %>% pull(avg_discharge_cfs)
discharge_after <- discharge_df %>% filter(period == "after") %>% pull(avg_discharge_cfs)

gh_before <- gage_height_df %>% filter(period == "before") %>% pull(avg_gage_height_ft)
gh_during <- gage_height_df %>% filter(period == "during") %>% pull(avg_gage_height_ft)
gh_after <- gage_height_df %>% filter(period == "after") %>% pull(avg_gage_height_ft)

# Table 5
streamflow_summary <- tibble(
  "Period" = c("Before Removal", "During Removal", "After Removal"), 
  "Dates" = c("Jan 2007–Sept 2011", "Sept 2011–Aug 2014", "Aug 2014–Dec 2017"),
  "n" = c(length(discharge_before) %>% format(big.mark=","), 
          length(discharge_during) %>% format(big.mark=","), 
          length(discharge_after)) %>% format(big.mark=","),
  "mean_dis" = c(round(mean(discharge_before)) %>% format(big.mark=","),  
                 round(mean(discharge_during)) %>% format(big.mark=","),
                 round(mean(discharge_after)) %>% format(big.mark=",")),
  "mean_gh" = c(round(mean(gh_before), digits = 1) %>% format(big.mark=","),  
                round(mean(gh_during), digits = 1) %>% format(big.mark=","),
                round(mean(gh_after), digits = 1) %>% format(big.mark=",")),
)

kable(streamflow_summary, 
      caption = "Summary of Streamflow Data Before, During, and After Dam Removal (2008–2017, USGS Site 12045500)",
      align = c("l", "c", "r", "r", "r"), 
      col.names = c("Period", "Dates", "Observations", "Mean Discharge (cfs)", "Mean Gage Height (ft)")) %>% 
  row_spec(0, align = "c", bold = TRUE) %>% 
  kable_classic(full_width = FALSE) 

```

A one-way ANOVA test was used to assess whether discharge and gage height levels were significantly different during each period. **Table 8** summarizes the output of the ANOVA and Post-Hoc analysis. Discharge levels during dam removal were not significantly different from discharge levels before and after removal (p-value of 0.94 and 0.09, respecitvely). However, discharge levels before removal did differ significantly from discharge levels after removal (p=0.02).

Observed gage height varied much more significantly during removal. Gage height during removal was on-average 1.13 ft  and 1.38 ft higher than levels before and after removal, respectively. The ANOVA test confirmed that average gage height levels were significantly different during all periods analyzed. 

```{r echo=FALSE}
# ANOVA Analysis
discharge_anova <- aov(discharge_df$avg_discharge_cfs ~ discharge_df$period)
discharge_post <- TukeyHSD(discharge_anova)
gh_anova <- aov(gage_height_df$avg_gage_height_ft ~ gage_height_df$period)
gh_post <- TukeyHSD(gh_anova)


streamflow_anova <- tibble(
  "Period" = c("Before-During", "During-After", "Before-After"), 
  "diff_dis" = c(discharge_post$`discharge_df$period`["during-before","diff"], 
                 discharge_post$`discharge_df$period`["during-after","diff"], 
                 discharge_post$`discharge_df$period`["before-after","diff"]), 
  "p_dis" = c(discharge_post$`discharge_df$period`["during-before","p adj"], 
              discharge_post$`discharge_df$period`["during-after","p adj"], 
              discharge_post$`discharge_df$period`["before-after","p adj"]), 
  "diff_gh" = c(gh_post$`gage_height_df$period`["during-before","diff"], 
                gh_post$`gage_height_df$period`["during-after","diff"], 
                gh_post$`gage_height_df$period`["before-after","diff"]),  
  "p_gh" = c(gh_post$`gage_height_df$period`["during-before","p adj"], 
             gh_post$`gage_height_df$period`["during-after","p adj"], 
             gh_post$`gage_height_df$period`["before-after","p adj"])
) %>% 
  mutate(across(c(diff_dis:p_gh), ~round(., digits = 2)), 
         across(contains("p_"), ~case_when(.<0.01 ~ paste0(., "**"), 
                                           .<0.05 ~ paste0(., "*"), 
                                           TRUE ~ as.character(.))))
                                          

kable(streamflow_anova, 
      caption = "ANOVA Analysis of Streamflow Data Before, During, and After Dam Removal (2008–2017, USGS Site 12045500)",
      align = c("l", "r", "r", "r", "r"), 
      col.names = c("Period", "Difference", "P-Value", "Difference", "P-Value")) %>% 
  row_spec(0, align = "c", bold = TRUE) %>% 
  add_header_above(
    header = c(" "=1, "Discharge (cfs)"=2, "Gage Height (ft)"=2), align = "c", bold = TRUE) %>% 
  kable_classic(full_width = FALSE) 

```

We used time series analysis to understand whether there was a monotonic trend in discharge and gage height along the Elwha River before, during, and after dam removal. 

As is evident in **Figures 4** and **5.B**, both discharge and gage height follow seasonal patterns. We decomposed our time series data to isolate the seasonal component from the overall trend observed over the 10-year period. **Figure 10** shows the trend component (in red) overlaying the recorded data for both discharge and gage height. From this figure, it appears that gage height increased during dam removal and decreased again following completion. There is a less clear trend with regards to discharge.

```{r include=FALSE}
# df of all dates over time period
dates <- tibble("date" = seq.Date(ymd(start), ymd(end), by = "day"))

# join timeseries datasets on date object
ts_df <- dates %>% 
  left_join(gage_height_df, by = "date") %>%  # 130 days missing 
  left_join(discharge_df %>% select(-site_no, -site_location), by = "date") %>% 
  # use linear interpolation to fill in gaps
  mutate(avg_discharge_cfs = zoo::na.approx(avg_discharge_cfs))

first_month <- month(first(ts_df$date))
first_year <- year(first(ts_df$date))

# Create time series objects
discharge_ts <- ts(ts_df$avg_discharge_cfs, 
                   start = c(first_year, first_month), 
                   frequency = 365)
gage_height_ts <- ts(ts_df$avg_gage_height_ft, 
                     start = c(first_year, first_month), 
                     frequency = 365)
```

```{r include=FALSE}
# Seasonal Decomposition of Time Series by Loess
discharge_decomp <- stl(discharge_ts, s.window = "periodic")
gage_height_decomp <- stl(gage_height_ts, s.window = "periodic")
```

```{r echo=FALSE, fig.height=6, message=FALSE, fig.cap='Discharge and Gage Height Decomposed Time Series'}
# Show decomposed trends
## Gage Height
gage_height_to_plot <- tibble("date" = ts_df$date,
                              "gage_height_trend" = gage_height_decomp$time.series[,"trend"],
                              "gage_height" = ts_df$avg_gage_height_ft) %>% 
  pivot_longer(cols = c("gage_height", "gage_height_trend"), 
               names_to = "data_type") %>% 
  mutate(data_type = factor(data_type, 
                            levels = c("gage_height", "gage_height_trend"), 
                            labels = c("Recorded Value", "Decomposed Trend")))

## Discharge
discharge_to_plot <- tibble("date" = ts_df$date, 
                            "discharge_trend" = discharge_decomp$time.series[,"trend"], 
                            "discharge" = ts_df$avg_discharge_cfs) %>% 
  pivot_longer(cols = c("discharge", "discharge_trend"), 
               names_to = "data_type") %>% 
  mutate(data_type = factor(data_type, 
                            levels = c("discharge", "discharge_trend"), 
                            labels = c("Recorded Value", "Decomposed Trend")))

# base plot components 
base_plot <- function(ymin, ymax, vjust){
  base_plot <- ggplot() + 
    geom_rect(aes(xmin = start_removal, xmax = complete_removal, 
                ymin = ymin, ymax = ymax), alpha = 0.4, fill = "grey") + 
    annotate(geom = "text", x = ymd("2013-03-01"), y = ymax-vjust, size = 2,
             label = "Dam Removal Period\n(Sept 2011–Aug 2014)") +
    scale_color_manual(values = c("darkgrey", "red")) +
    scale_y_continuous(limits = c(ymin, ymax)) +
    scale_x_date(expand = c(0,0))
  
  return(base_plot)
}

# Discharge
discharge_plot <- base_plot(ymin = 0, ymax = 15000, vjust = 1050) + 
  geom_line(data = discharge_to_plot, 
            aes(x = date, y = value, color = data_type)) + 
  scale_y_continuous(labels = scales::comma) + 
  theme(legend.position = "none") + 
  labs(y = "Daily Average Discharge (cfs)", 
       x = NULL,
       color = NULL,
       title = "Daily Discharge and Gage Height Decomposed Time Series", 
       subtitle = "Elwah River, USGS Station 12045500, 2008–2016")

# Gage Height
gage_height_plot <- base_plot(ymin = 9, ymax = 19.5, vjust = 1) +
  geom_line(data = gage_height_to_plot, 
            aes(x = date, y = value, color = data_type)) +
  labs(y = "Daily Average\nGage Height (ft)", 
       x = "Year",
       color = NULL)
  
plot_grid(discharge_plot, gage_height_plot, nrow = 2, labels = c("A", "B"))
```

\newpage

For our analysis, we adjusted the discharge and gage height data for seasonality by removing the seasonal component. The seasonally adjusted time series for both datasets were then split into three periods: before the start of removal, during removal, and after removal was completed. A Mann Kendall Test was used to assess whether discharge and gage height were stationary during each period. Results of this analysis are outlined in **Table 9**. 

```{r include=FALSE}
## split up the time series with seasonality removed

split_up_ts <- function(ts_decomp){
  ts_no_season <- ts_decomp$time.series[, "trend"] + ts_decomp$time.series[, "remainder"]
  
  start_index <- which(dates$date == start_removal)
  end_index <- which(dates$date == complete_removal)
  
  # separate out trend components during each period
  before <- ts_no_season[1:(start_index-1)] %>% ts()
  during <- ts_no_season[start_index:end_index] %>% ts()
  after <- ts_no_season[(end_index+1):length(ts_decomp)] %>% ts()
  
  return(list(before, during, after))
}

discharge_ts_before <- split_up_ts(discharge_decomp)[[1]]
discharge_ts_during <- split_up_ts(discharge_decomp)[[2]]
discharge_ts_after <- split_up_ts(discharge_decomp)[[3]]

gage_height_ts_before <- split_up_ts(gage_height_decomp)[[1]]
gage_height_ts_during <- split_up_ts(gage_height_decomp)[[2]]
gage_height_ts_after <- split_up_ts(gage_height_decomp)[[3]]
```

```{r echo=FALSE, warning=FALSE}
## Perform Dickey Fuller Test

adf_test_results <- tibble(
  "period" = c("Before", "During", "After"),
  "dates" = c("Jan 2008–Sept 2011", "Sept 2011–Aug 2014", "Aug 2014–Dec 2017"), 
  "avg_d" = c(mean(ts_df %>% filter(date<start_removal) %>% pull(avg_discharge_cfs)), 
              mean(ts_df %>% filter((date>=start_removal)&(date<=complete_removal)) %>%
                     pull(avg_discharge_cfs)), 
              mean(ts_df %>% filter(date>complete_removal) %>% pull(avg_discharge_cfs))), 
  "p_value_d" = c(MannKendall(discharge_ts_before)$sl[[1]], 
                  MannKendall(discharge_ts_during)$sl[[1]], 
                  MannKendall(discharge_ts_after)$sl[[1]]),
  "tau_d" = c(MannKendall(discharge_ts_before)$tau[[1]], 
              MannKendall(discharge_ts_during)$tau[[1]], 
              MannKendall(discharge_ts_after)$tau[[1]]),
  "avg_gh" = c(mean(ts_df %>% filter(date<start_removal) %>% pull(avg_gage_height_ft)), 
               mean(ts_df %>% filter((date>=start_removal)&(date<=complete_removal)) %>%
                      pull(avg_gage_height_ft)), 
               mean(ts_df %>% filter(date>complete_removal) %>% pull(avg_gage_height_ft))),  
  "p_value_gh" = c(MannKendall(gage_height_ts_before)$sl[[1]], 
                   MannKendall(gage_height_ts_during)$sl[[1]], 
                   MannKendall(gage_height_ts_after)$sl[[1]]),
  "tau_gh" = c(MannKendall(gage_height_ts_before)$tau[[1]], 
               MannKendall(gage_height_ts_during)$tau[[1]], 
               MannKendall(gage_height_ts_after)$tau[[1]]),
  ) %>% 
  mutate(across(c("avg_d", "tau_d", "avg_gh", "tau_gh"), 
                ~round(., digits=2) %>% format(big.mark=",")), 
         across(contains("p_value"), ~ifelse(as.numeric(.)<0.05, 
                                             paste0(round(., digits=4), "*"), 
                                             round(., digits =5))))

kable(adf_test_results, 
      caption = "Mann Kendall Test of Streamflow Data - USGS Site 12045500", 
      col.names = c("Period", "Dates", "Average Value", "P-Value", "Tau", 
                    "Average Value", "P-Value", "Tau"), 
      align = c("c", "c", "r", "r", "r", "r", "r", "r")) %>% 
  row_spec(0, align = "c", bold = TRUE) %>% 
  add_header_above(
    header = c(" "=2, "Discharge (cfs)"=3, "Gage Height (ft)"=3), align = "c", bold = TRUE) %>% 
  kable_classic(full_width = FALSE)
```

The results of this analysis indicate that there were significant monotonic trends to both discharge and gage height levels over the periods before, during, and after dam removal. From these results, it is difficult to isolate a specific response in streamflow as a result of dam removal. We do observe a particularly strong negative trend (tau = -0.39) in gage height levels after dam removal, which may suggest that river height returned to an equilibrium following the completion of the dam removals. 
\newpage

## IV.B. Question 2. Is there a significant impact on sediment load and concentration following dam removal?

As show in **Figure 7** above and **Figure 11** below, suspended sediment levels appear to be heightened during the period of dam removal compared to levels after removal. We performed a two-sample t-test to assess whether there is a significant difference in mean sediment concentration during and after removal. 

```{r echo=FALSE, fig.height=3, fig.cap="Distribution of Sediment Concentration During and After Dam Removal at USGS Site 12046260 (2011–2016)"}
ssc_df <- daily_sediment_df %>% 
  mutate(period = case_when(date <= complete_removal ~ "During Removal", 
                            date > complete_removal  ~ "After Removal"), 
         period = factor(period, levels = c("During Removal", "After Removal"))) %>% 
  select(date, period, daily_ssc_mg_l)

ggplot(ssc_df) + 
  geom_boxplot(aes(x = period, y = daily_ssc_mg_l)) + 
  scale_y_continuous(labels = scales::comma, 
                     limits = c(0, 15000),
                     breaks = seq(0, 15000, by = 5000)) + 
  labs(x = NULL, 
       y = "Daily Sediment Concentration (mg/L)", 
       title = "Daily Suspended Sediment Concentration During and After Dam Removal", 
       subtitle = "Elwha River, USGS Station 12046260, 2011–2016\n")
```

A directional two-sample t-test compared the suspended sediment concentrations recording during dam removal (n = 1,077 days) and after removal (n = 766 days). **Table 10** shows a summary of average suspended sediment concentrations before and after removal. This t-test had a p-value of 2.44e-24 (H1 being that levels were higher during removal), which confirms that suspended sediment concentration was significantly higher in the Elwha River during dam removal relative to after dam removal. While dam removal released millions of tons of sediment trapped behind both dams, suspended sediment concentrations appear to reach an equilibrium several months following the completion of both dam removals. 

```{r echo = FALSE}

ssc_during <- ssc_df %>% filter(period == "During Removal") %>% pull(daily_ssc_mg_l)
ssc_after <- ssc_df %>% filter(period == "After Removal") %>% pull(daily_ssc_mg_l)

# p-value < 2.2e-16
t_test_ssc <- t.test(ssc_during, ssc_after, alternative = "greater")

ssc_means_table <- tibble(
  "Period" = c("During Removal", "After Removal"), 
  "Dates" = c("Sept 2011–Aug 2014", "Aug 2014–Sept 2016"),
  "Observations" = c(nrow(ssc_df %>% filter(period == "During Removal")), 
                     nrow(ssc_df %>% filter(period == "After Removal"))),
  "Average (1)" = c(round(mean(ssc_during), digits=2) %>% format(big.mark=","),  
                round(mean(ssc_after), digits=2))
)

kable(ssc_means_table, 
      caption = "Suspended Sediment Concentration (mg/L) During and After Dam Removal (USGS Site 12046260)",
      align = c("l", "c", "r", "r")) %>% 
  row_spec(0, align = "c", bold = TRUE) %>% 
  kable_classic(full_width = FALSE) 

```
\newpage

## IV.C. Question 3. Is water quality and nutrient availability impacted by the dam removal?

Based on the exploratory analysis, only nitrate/nitrile, phosphate, ammonium, and dissoled oxygen concentrations were considered in this water quality analysis (**Figure 12**). Each datapoint is based on one reported measurement with no error attached, no statistical analyses were run. Thus, all analysis of this data is based on visual evaluation.

Scientifically, these parameters are all highly interconnected. An increase in nitrates will cause an increase in phosphate, leading to an excess of plant growth and decomposition. As a result, dissolved oxygen will decrease and may impact aquatic animals. Optimal ranges for these compounds include 0.16 - 48.38 uM for nitrate with lower being better (Lehigh University), and arounf 0.50 uM for phosphate (Lake James Environmental Association). Concentrations of all analyzed parameters do not breech unsafe thresholds.

Nitrate/nitrile, phosphate, and ammonium concentrations are consistent or increased during dam removal. At ES2, ammonium concentrations are the most changed between dam conditions. Dissolved oxygen levels appear to decrease during the dam removal at sites that were sampled before and during removal.

Lack of data at all sites before the dam removal makes it difficult to assess if these trends are due to the site specifically or the removal of the dam. The expected relationships described above are generally represented for nitrate, phosphate, and to some extent dissolved oxygen. The data on ammonium are hindered by missing data points in the middle of the time period, but levels do appear to be higher during removal.


```{r echo = FALSE, fig.cap = "Water quality in the Elwha River estuary before and during dam removal", fig.height = 7}

# Final water quality plot
estuary_wq_plot <- plot_grid(dataset_title,
                             nitrate_title, nitrate_plot,
                             phos_title, phos_plot,
                             do_title, do_plot,
                             amm_title, amm_plot,
                             estuary_wq_legend,
                             nrow = 10, rel_heights = c(2,1,5,1,5,1,5,1,5,1,5,1))
estuary_wq_plot
```

\newpage


## IV.D. Question 4. Is there a shift in the types of taxa consumed by salmon before and after the dam removal?

The number of unique taxa consumed by each salmon species was assessed (**Figure 13**). 

```{r echo = FALSE, fig.cap = "Number of unique taxa consumed by Chinook and Coho salmon in each year samples were collected"}
salmon_taxa_totals_plot <- ggplot(data = data.frame(
  Salmon = c(rep("Chinook", 4), rep("Coho", 4)),
  Year = c(rep(c("2006", "2007", "2013", "2014"),2)),
  Count = c(sum(chinook_diet$value_2006 > 0),
            sum(chinook_diet$value_2007 > 0),
            sum(chinook_diet$value_2013 > 0),
            sum(chinook_diet$value_2014 > 0),
            sum(coho_diet$value_2006 > 0),
            sum(coho_diet$value_2007 > 0),
            sum(coho_diet$value_2013 > 0),
            sum(coho_diet$value_2014 > 0))),
  aes(x = Year, y = Count, fill = as.factor(Salmon))) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Number of Dietary Taxa Observed in Salmon Diets",
       x = NULL,
       y = "Number of Taxa Observed",
       fill = "Salmon Species") +
  scale_fill_manual(values = c("Chinook" = "#4d9221", "Coho" = "#91bfdb"))
salmon_taxa_totals_plot
```

Before removal and into 2013, the diversity of taxa consumed by Chinook salmon appears largely unchanged. However, there was a large increase in 2014, going from 56 to 85 taxa in 2013 and 2014, respectively. Coho salmon saw more consistency in diet over the two dam conditions, where levels were generally similar between the 2006-2007 and 2013-2014. Between 2007 and 2013, an increase in 36 taxa was observed. These results suggest that dam removal had a positive impact on the diversity of both Chinook and Coho salmon diet.

For each year, the distribution of the top 10 taxa observed in Chinook (**Figure 14**) and Coho (**Figure 15**) salmon were plotted to assess general trends.

``` {r echo = FALSE, fig.cap = "Total counts of the 10 most common dietary taxa each year in Chinook salmon", fig.height=7}
# Chinook taxa in 2006
chinook_taxa_2006 <- chinook_diet %>% 
  select(fish:value_2006) %>% 
  arrange(desc(value_2006)) %>%
  filter(value_2006 > 0)

chinook_top_taxa_plot_2006 <- ggplot(data = chinook_taxa_2006 %>% head(10),
                                     aes(x = reorder(taxa, -value_2006), y = value_2006)) +
  geom_bar(stat = "identity", fill = "black") +
  theme(axis.text.x = element_text(angle = 60, hjust = 1)) +
  labs(x = NULL,
       y = NULL,
       title = "2006")
#chinook_top_taxa_plot_2006

# Chinook taxa in 2007
chinook_taxa_2007 <- chinook_diet %>% 
  select(fish:taxa, value_2007) %>% 
  arrange(desc(value_2007)) %>%
  filter(value_2007 > 0)

chinook_top_taxa_plot_2007 <- ggplot(data = chinook_taxa_2007 %>% head(n = 10),
                                     aes(x = reorder(taxa, -value_2007), y = value_2007)) +
  geom_bar(stat = "identity", fill = "black") +
  theme(axis.text.x = element_text(angle = 60, hjust = 1)) +
  labs(x = NULL,
       y = NULL,
       title = "2007")
#chinook_top_taxa_plot_2007

# Chinook in 2013

chinook_taxa_2013 <- chinook_diet %>%
  select(fish:taxa, value_2013) %>%
  arrange(desc(value_2013)) %>%
  filter(value_2013 > 0)

chinook_top_taxa_plot_2013 <- ggplot(data = chinook_taxa_2013 %>% head(n = 10),
                                     aes(x = reorder(taxa, -value_2013), y = value_2013)) +
  geom_bar(stat = "identity", fill = "black") +
  theme(axis.text.x = element_text(angle = 60, hjust = 1)) +
  labs(x = NULL,
       y = NULL,
       title = "2013")
#chinook_top_taxa_plot_2013

# Chinook in 2014

chinook_taxa_2014 <- chinook_diet %>%
  select(fish:taxa, value_2014) %>%
  arrange(desc(value_2014)) %>%
  head(n = 10)

chinook_top_taxa_plot_2014 <- ggplot(data = chinook_taxa_2014,
                                     aes(x = reorder(taxa, -value_2014), y = value_2014)) +
  geom_bar(stat = "identity", fill = "black") +
  theme(axis.text.x = element_text(angle = 60, hjust = 1)) +
  labs(x = NULL,
       y = NULL,
       title = "2014")
#chinook_top_taxa_plot_2014

chinook_diet_4x4 <- plot_grid(chinook_top_taxa_plot_2006,
                              chinook_top_taxa_plot_2007,
                              chinook_top_taxa_plot_2013,
                              chinook_top_taxa_plot_2014,
                              nrow = 2,
                              ncol = 2)
chinook_diet_4x4
```

``` {r echo = FALSE, fig.cap = "Total counts of the 10 most common dietary taxa each year in Coho salmon", fig.height=7}
# coho taxa in 2006
coho_taxa_2006 <- coho_diet %>% 
  select(fish:value_2006) %>% 
  arrange(desc(value_2006)) %>%
  filter(value_2006 > 0)

coho_top_taxa_plot_2006 <- ggplot(data = coho_taxa_2006 %>% head(10),
                                     aes(x = reorder(taxa, -value_2006), y = value_2006)) +
  geom_bar(stat = "identity", fill = "black") +
  theme(axis.text.x = element_text(angle = 60, hjust = 1)) +
  labs(x = NULL,
       y = NULL,
       title = "2006")
#coho_top_taxa_plot_2006

# coho taxa in 2007
coho_taxa_2007 <- coho_diet %>% 
  select(fish:taxa, value_2007) %>% 
  arrange(desc(value_2007)) %>%
  filter(value_2007 > 0)

coho_top_taxa_plot_2007 <- ggplot(data = coho_taxa_2007 %>% head(n = 10),
                                     aes(x = reorder(taxa, -value_2007), y = value_2007)) +
  geom_bar(stat = "identity", fill = "black") +
  theme(axis.text.x = element_text(angle = 60, hjust = 1)) +
  labs(x = NULL,
       y = NULL,
       title = "2007")
#coho_top_taxa_plot_2007

# coho in 2013

coho_taxa_2013 <- coho_diet %>%
  select(fish:taxa, value_2013) %>%
  arrange(desc(value_2013)) %>%
  filter(value_2013 > 0)

coho_top_taxa_plot_2013 <- ggplot(data = coho_taxa_2013 %>% head(n = 10),
                                     aes(x = reorder(taxa, -value_2013), y = value_2013)) +
  geom_bar(stat = "identity", fill = "black") +
  theme(axis.text.x = element_text(angle = 60, hjust = 1)) +
  labs(x = NULL,
       y = NULL,
       title = "2013")
#coho_top_taxa_plot_2013

# coho in 2014

coho_taxa_2014 <- coho_diet %>%
  select(fish:taxa, value_2014) %>%
  arrange(desc(value_2014)) %>%
  head(n = 10)

coho_top_taxa_plot_2014 <- ggplot(data = coho_taxa_2014,
                                     aes(x = reorder(taxa, -value_2014), y = value_2014)) +
  geom_bar(stat = "identity", fill = "black") +
  theme(axis.text.x = element_text(angle = 60, hjust = 1)) +
  labs(x = NULL,
       y = NULL,
       title = "2014")
#coho_top_taxa_plot_2014

coho_diet_4x4 <- plot_grid(coho_top_taxa_plot_2006,
                              coho_top_taxa_plot_2007,
                              coho_top_taxa_plot_2013,
                              coho_top_taxa_plot_2014,
                              nrow = 2,
                              ncol = 2)
coho_diet_4x4
```

\newpage

Upon initial investigation, it is clear that the diets of Chinook and Coho salmon have diversified by 2014. Chinook salmon appear more resistant to changes in the diet, as diversitifaction lagged behind Coho by one year. Without normalizing the data, no conclusions can be drawn regarding the abundance of food consumed. It is hypothesized that salmon will consume more, and this should be a focus of future research.

To assess how the top taxa were impacted by dam removal, the top ten overall taxa were visualized. These taxa were identified by summing the counts across all years for each taxa. For Chinook salmon, the taxa chironomidae (non-biting midges) are dominant before and after removal (**Figure 16.A**). Other taxa, such as cladocera (water flea), chironomini (within the midge tribe), cyclopoida (order of small crustaceans), and osteichthyes (bony fishes) were present before removal, either at low counts or not at all during removal. This could be due to water quality changes that these taxa cannot tolerate or do not prefer, increased choice in foods such that salmon prefer to not eat these taxa, or a number of other reasons. Besides chironomidae, only amphipoda (an order of malacostracan crustaceans) and hilara (genus of dance flies) saw increased consumption after dam removal as compared to before.

In Coho salmon, chironomidae are the dominant group before and after removal (**Figure 16.B**). The overall taxa for Coho salmon are certainly dominated by the pre-dam removal state. Few of the taxa identified here have appreciable counts during the removal. This is likely due to the diversification of their diet after removal.

```{r, echo = FALSE, warning=FALSE, message=FALSE, fig.cap = "Top taxa for Chinook and Coho salmon before and during dam removal"}

# Overall
chinook_top_taxa <- salmonid_diet_processed %>%
  filter(fish == "Chinook") %>%
  arrange(desc(total_count)) %>%
  head(10) %>%
  select(fish:taxa, before_count:after_count) %>%
  pivot_longer(cols = c(before_count, after_count)) 

chinook_top_taxa_plot <- ggplot(chinook_top_taxa, aes(x = taxa, y = value, fill = as.factor(name))) +
  geom_bar(stat = "identity", position = "dodge") +
    theme(axis.text.x = element_text(angle = 20, hjust = 1),
          plot.title = element_text(face = "bold")) +
  labs(title = "Chinook",
       x = NULL,
       y = "Count",
       fill = NULL) +
  scale_fill_manual(values = c("before_count" = "#4d9221", "after_count" = "#91bfdb"),
                    labels = c("Before", "After")) + 
  theme(legend.position = "none")
# chinook_top_taxa_plot

# dam_state_legend <- get_legend(ggplot(chinook_top_taxa, aes(x = taxa, y = value, fill = name)) +
#   geom_bar(stat = "identity", position = "dodge") +
#     labs(fill = NULL) +
#     scale_fill_manual(values = c("before_count" = "#4d9221", 
#                                  "after_count" = "#91bfdb"),
#                       labels = c("Before", "After"))) 

# chinook_top_taxa_3x3 <- plot_grid(chinook_top_taxa_plot,
#                                   dam_state_legend,
#                                   nrow = 2,
#                                   rel_heights = c(3, 0.1))
# chinook_top_taxa_3x3

# Overall
coho_top_taxa <- salmonid_diet_processed %>%
  filter(fish == "Coho") %>%
  arrange(desc(total_count)) %>%
  head(10) %>%
  select(fish:taxa, before_count:after_count) %>%
  pivot_longer(cols = c(before_count, after_count))

coho_top_taxa_plot <- ggplot(coho_top_taxa, aes(x = taxa, y = value, fill = as.factor(name))) +
  geom_bar(stat = "identity", position = "dodge") +
    theme(axis.text.x = element_text(angle = 20, hjust = 1),
          plot.title = element_text(face = "bold")) +
  labs(title = "Coho",
       x = NULL,
       y = "Count",
       fill = NULL) +
  scale_fill_manual(values = c("before_count" = "#4d9221", "after_count" = "#91bfdb"),
                    labels = c("Before", "After")) 
  #theme(legend.position = "none")
# coho_top_taxa_plot

# coho_top_taxa_3x3 <- plot_grid(coho_top_taxa_plot,
#                                   dam_state_legend,
#                                   nrow = 2,
#                                   rel_heights = c(3, 0.1))
# coho_top_taxa_3x3

top_diet_title <- ggplot() + 
  labs(title = "Top Dietary Taxa Observed Across the Study Period (2006 - 2014)") +
  theme(plot.title = element_text(hjust = 0.5))

top_salmon_taxa_plot <- plot_grid(top_diet_title,
                                chinook_top_taxa_plot,
                                coho_top_taxa_plot,
                                #dam_state_legend,
                                nrow = 3,
                                rel_heights = c(2, 8, 10), 
                                labels = c("", "A", "B"))
top_salmon_taxa_plot
```

\newpage

To better understand the diet of Chinook and Coho during the dam removal, **Figure 17** shows the top taxa observed in both salmon populations during dam removal (2013–2014). This figure shows levels of these top taxa observed both before dam removal as well to assess if these taxa were newly intriduced into the diet or ones that were being consumed before dam removal.

```{r, echo = FALSE, message = FALSE, warning = FALSE, fig.cap = "Top taxa for Chinook salmon during dam removal"}
during_diet_title <- ggplot() + 
  labs(title = "Top Dietary Taxa Observed During Removal (2013–2014)") +
  theme(plot.subtitle = element_text(hjust = 0.5))

# Get data for top during taxa for Chinook

chinook_top_after_taxa <- salmonid_diet_processed %>%
  filter(fish == "Chinook") %>%
  select(taxa, after_count) %>% 
  arrange(desc(after_count)) %>%
  head(10) %>% 
  left_join(chinook_diet) %>% 
  select(taxa:after_count, before_count) %>% 
  pivot_longer(c("before_count", "after_count")) %>% 
  mutate(name = factor(name, levels = c("before_count", "after_count")))

chinook_top_after_taxa_plot <- ggplot(chinook_top_after_taxa, 
                                      aes(x = taxa, y = value, fill = as.factor(name))) +
  geom_bar(stat = "identity", position = "dodge") +
    theme(axis.text.x = element_text(angle = 15, hjust = 1)) +
  labs(title = "Chinook",
       x = NULL,
       y = "Count",
       fill = NULL) +
  scale_fill_manual(values = c("before_count" = "#91bfdb", "after_count" = "#4d9221"), 
                    labels = c("Before", "After")) + 
  theme(legend.position = "none",
        plot.title = element_text(face = "plain"))

# Get data for top during taxa for Coho

coho_top_after_taxa <- salmonid_diet_processed %>%
  filter(fish == "Coho") %>%
  select(taxa, after_count) %>% 
  arrange(desc(after_count)) %>%
  head(10) %>% 
  left_join(coho_diet) %>% 
  select(taxa:after_count, before_count) %>% 
  pivot_longer(c("before_count", "after_count")) %>% 
  mutate(name = factor(name, levels = c("before_count", "after_count")))

coho_top_after_taxa_plot <- ggplot(coho_top_after_taxa, aes(x = taxa, y = value, fill = as.factor(name))) +
  geom_bar(stat = "identity", position = "dodge") +
    theme(axis.text.x = element_text(angle = 15, hjust = 1)) +
  labs(title = "Coho",
       x = NULL,
       y = "Count",
       fill = NULL) +
  scale_fill_manual(values = c("before_count" = "#91bfdb", "after_count" = "#4d9221"), 
                    labels = c("Before", "After")) + 
  theme(#legend.position = "none",
        plot.title = element_text(face = "plain"))

top_after_taxa_plot <- plot_grid(during_diet_title,
                                chinook_top_after_taxa_plot,
                                coho_top_after_taxa_plot,
                                #dam_state_legend,
                                nrow = 4,
                                rel_heights = c(2, 8, 10), 
                                labels = c("", "A", "B"))
top_after_taxa_plot
```

The taxa consumed by both Chinook and Coho during dam removal is dominated by new species. Between Chinook and Coho, the taxa consumed during the dam removal are similar. Notable overlaps include chironomidae, cyclopoida, and orthocladiinae.

\newpage

# V. Summary and Conclusions

The impact of the removal of two dams from the Elwha River was assessed using physical and ecological endpoints. A number of datasets generated by USGS before, during, and after dam removal were utilized. It is clear that the removal of these dams has had a profound impact on river characteristics and salmon behaviors.

Stream discharge was not greatly impacted over the period analyzed. While the time series analysis did find significant monotonic trend in observed discharge levels during all periods analyzed (**Figure 10**, **Table 9**), average discharge levels during removal were not significantly different from levels before and after removal. However, an ANOVA test confirmed that there was a signficant difference (p=0.02) between discharge levels observed before and after removal (see **Table 8**). This may be explained by changes in river shape and turbidity as a result of the release of over 100-years worth of accumulated sediment following dam removal (National Park Service, 2016).

Gage height rose significantly during dam removal. A one-way ANOVA test confirmed that gage height was significantly different during dam removal compared to the periods before and after (**Table 8**). A time series analysis confirmed that there were significant monotonic trends during all three periods surrounding dam removal, and that there was a strong positive trend in gage height during removal, and a strong negative trend following its completion (**Figure 10**, **Table 9**). Ritchie et al. (2018) found that changes in river stage could be attributed to widespread riverbed aggradation. In other words, increased sediment deposition resulted in rising riverbed height and thus higher water levels. 

An analysis of suspended sediment load and concentration data found that suspended sediment levels were significantly altered during dam removal. A two-way directional t-test confirmed that suspended sediment concentration was significantly higher (p<0.001) during dam removal compared to after dam removal was completed. This change was a result of over 10 million tonnes of trapped sediment in the dams' reservoirs being released throughout the process of dam removal (East et al., 2015). **Figure 7** illustrates that high sediment concentration levels were sustained during dam removal but appear to diminish following its completion. This is likely do to the settlement of suspended sediment over time, while sediment loads continued to peak in the winter during periods of high winter flows and snow melt. Further analysis of sediment bedload could be interesting to understand how sediment deposits have impacted the morphology of the Elwha River in the years following the completion of the dam removal. 

Water quality was not heavily impacted over the time range analyzed, and levels did not exceed unsafe levels. It does appear that some nutrient concentrations were elevated after removal at sites that were monitored before dam removal. To fully assess how water quality was impacted by dam removal, significantly more timepoints and locations would have needed to be tested.

The diet of two salmon species, Chinook and Coho, was assessed. Although the data were not able to be normalized, it appears that the diet of both species was diversified by 2014. There was some overlap in diets, particularily for Chinook salmon between the dam removal states, however, Coho salmon saw a shift in food sources during the dam removal. Between the two species, there was some overlap in taxa consumed, such as chironomidae, hilara, and tanypodinae, however, more analysis of these variables would better elucidate the similarities and differences in the diet of Chinook and Coho. Further investigations of invertebrate density and abundance would clarify if the food these fish are consuming is due to presence and abundance or out of preference due to increased diversity.

It can be seen that the removal of the two dams that previously blocked the Elwha River for nearly a century have positively impacted the physical and biological parameters of the river. Natural conditions, such as streamflow and sediment, are returning to natural conditions and impacts to water quality may be productive for ecological restoration and wildlife conservation. The return of salmon into the river is notable, and it is clear that the dam removal has allowed for diversification of diet.

\newpage

# VI. Appendix

## VI.A. Data Sources

- Foley, M.M. et al., "Ecological parameters in the Elwha River estuary before and during dam removal," 2020, version 2.0: U.S. Geological Survey data release, https://doi.org/10.5066/F75B00N4.
    * Water quality in the Elwha River estuary, Washington, from 2006 to 2014: https://www.sciencebase.gov/catalog/item/58f626f8e4b0f2e20545e5ad
    * Diet of Chinook and coho salmon in the Elwha River estuary, Washington, before and during dam removal: https://www.sciencebase.gov/catalog/item/5f287fa082cef313ed9e1c96
- Ritchie, A.C. et al., "Daily sediment loads during and after dam removal in the Elwha River, Washington, 2011 to 2016," 2018, Data in support of 5-year sediment budget and morphodynamic analysis of Elwha River following dam removals: U.S. Geological Survey data release, https://doi.org/10.5066/F7PG1QWC.
- Water Data for the Nation, USGS, https://waterdata.usgs.gov/
    * USGS Site 12045500: https://waterdata.usgs.gov/monitoring-location/USGS-12045500/ 
    * USGS Site 12044900: https://waterdata.usgs.gov/monitoring-location/USGS-12044900/

## VI.B. References


- Coastal Watershed Institute (CWI) 2022. Elwha River Dam Removals: A Nearshore Synthesis a Decade After the World’s Largest Dam Removal Project. A CWI Technical Report. Coastal Watershed Institute Port Angeles, Washington. ISSN 092022:1. ISSN2643-9697, Available at https://coastalwatershedinstitute.org/wp-content/uploads/2022/10/Elwha-Nearshore-Synthesiscwisept2022techmemo-1.pdf 
- East, A. E. et al., "Large-scale dam removal on the Elwha River, Washington, USA: River channel and floodplain geomorphic change", May 1, 2014, *Geomorphology*, 228, 765–786. https://doi.org/10.1016/j.geomorph.2014.08.028
- Fahlquist, L., Hopkins, C., "Why We Use Gage Height," *USGS*, November 25, 2025. Available at https://waterdata.usgs.gov/blog/gage_height/.
- Kojima, A.C., Pearsall, P., and Gussman, J. "The Elwha River: Landscapes of Recovery," *USGS*. Available at https://geonarrative.usgs.gov/elwhariverrestoration/.
- Lake James Environmental Association, "Nutrients", n.d. Available at https://www.ljea.org/2018-state-lake-james-watershed/chemical-analysis-water-quality/nutrients/
- Lehigh University, "Nitrates", n.d. Available at https://ei.lehigh.edu/envirosci/watershed/wq/wqbackground/nitratesbg.html
- Mapes, L.V., "Elwha: Roaring back to life," *The Seattle Times*, February 13, 2016. Available at https://projects.seattletimes.com/2016/elwha/.
- National Park Service, "Dam Removal," March 28, 2025. Available at https://www.nps.gov/olym/learn/nature/dam-removal.htm.
- National Park Service, "Elwha River Restoration Research, August 9, 2016. Available at https://www.nps.gov/olym/learn/nature/elwha-research-efforts.htm
- Ritchie, A.C., "Morphodynamic evolution following sediment release from the world’s largest dam removal," *Scientific Reports* 8, 13279 (2018), https://doi.org/10.1038/s41598-018-30817-8
- U.S. Geological Survey, "Coastal Habitats of the Elwha River, Washington - Biological and Physical Patterns and Processes Prior to Dam Removal", 2011. available at https://pubs.usgs.gov/publication/sir201151201
